# 预备知识

1. 有限元的网格由单元构成，相邻单元仅在共享的节点上彼此相连，单元的面和边是各自的，不一定共享。
2. 数学上来说，有限元是将一个连续的无限自由度问题，转化成了离散的有限自由度问题了。一旦求得有限节点上的自由度后，单元内部的值通过插值获得。
3. 如果单元满足收敛要求，则随着单元尺寸的变小，近似解将逐步趋于精确解。
4. 运动方程描述的是：应力和体积力之间的关系。物体处于平衡状态$\Leftrightarrow$运动方程的加速度项为0。
5. 几何方程描述的是：应变与位移的关系。
6. 本构（物理）方程描述的是：应力与应变的关系。
7. 在微小变形下，一个点的6个应变分量可用位移表示。
8. 最简单的材料是：各向同性均匀线弹性，其弹性矩阵可以由$E,G,\nu,\lambda,\mu$中任意两个表示。后两个为拉梅系数。
   1. 各向同性：材料在各个方向的行为都是一样的，例如沿各个方向进行拉伸。类似于一个球形，各个轴都是主轴。
   2. 均匀：不同位置的材料性质都一样，即描述材料性质的参数对空间的导数为0。
   3. 弹性：外力撤去后，变形能够完全恢复。
   4. 线性：材料的应力和应变呈线性关系。
9. 拉梅系数$\lambda,\mu$的换算关系：$\lambda=\frac{E\nu}{(1+\nu)(1-2\nu)}$，$\mu=\frac{E}{2(1+\nu)}$。其中$\nu$为泊松比。
10. 如果使用应力作为基本未知量来求解，就不再需要几何方程了，应变是通过本构关系得到的。此时应变还需要满足变形协调方程。如果使用位移作为基本未知量来求解，通过几何方程得到的应变是天然满足变形协调方程的。
11. 应力边界上的表面力需要在整体坐标系上进行分解，不考虑受压或受拉为正的情况。但是应力的正向总是使得分离体受拉为正。想想一下，在表面力边界附近切出一个薄层，右侧作用这表面力，左侧作用着爆露出来的是沿该方向的应力。左侧面上应力的正方向为向左，右侧面上表面力的正方向为全局的正方向，向右。因此$f_t=L\sigma$。上面的分析中，交换左右也是一样的结果。
12. 应力边界条件实际上是，应力作用处的薄层的各向受力平衡，由于薄层的尺寸很小，因此不用考虑力矩平衡。
13. 虚位移的偏导数：$\frac{\partial \delta u}{\partial x}$，虚应变：$\delta\varepsilon=\delta\frac{\partial u}{\partial x}$。由于变分和微分是可交换的，因此认为二者相等。
14. 节点，材料点，空间点。
    1. 节点构成单元，单元构成网格。拉格朗日网格的节点称为拉格朗日节点，欧拉网格的节点称为欧拉节点。
    2. 材料点是实际的物质，质量始终不变。随着物质的运动，空间位置会变化。
    3. 空间点是欧几里得空间中的几何点，它的位置是不随时间变化。
17. 拉格朗日网格中，网格点和材料点始终重合。欧拉网格中网格点和空间点始终重合。
18. 在外力作用下，材料变形时材料点会运动。因此拉格朗日网格会变形，而欧拉网格不会变形。
19. 边界条件是作用在材料边界上的材料点的，因此可以很容易地等效到拉格朗日节点上。而欧拉节点和材料点没有关联，因此需要将材料点的边界条件映射到欧拉节点上，比较复杂。
20. 如果一个拉格朗日节点一开始处于材料边界上，则它始终处于材料边界上，而欧拉节点则不一定。
21. 同一个场可以有拉格朗日描述，也可以有欧拉描述，取决于描述场所使用的坐标是拉格朗日的还是欧拉的，例如$v(X,t)$和$\bar{v}(x,t)$。二者的函数形式是不同的，可以通过$x=\phi(X,t)$转换。$X$为材料坐标，$x$为空间坐标。
22. 同一种网格可以采取不同的描述，例如都是拉格朗日网格，可以采取拉格朗日描述，也可以采取欧拉描述。
23. 由于拉格朗日网格对于畸变严重的变形，会导致单元的严重畸变，导致精度下降；同时欧拉网格对边界条件的处理比较复杂。因此产生了ALE网格，该网格的节点能够有序运动，和边界重合的节点随边界上的材料点运动，始终在边界上，内部的节点运动以使得网格扭曲最小化。这样可以同时借鉴两者的优点。
24. 拉格朗日网格中，积分点始终和特定的材料点重合，这样依赖历史的材料本构模型可以直接应用。
25. 使用拉格朗日网格的有限元分析方法称为拉格朗日有限元。
26. 拉格朗日网格+拉格朗日描述=完全的拉格朗日格式 T.L.，相当于在初始构形中描述。
27. 拉格朗日网格+欧拉描述=更新的拉格朗日格式 U.L.，相当于在当前构形中描述。可以和T.L.相互转换。
28. T.L.中常采用应变的完全度量，而U.L.中常采用应变的率度量。
29. 两种格式都将建立动量方程的弱形式，将变分项和动量方程乘积，然后积分。
    1. T.L中变分项为虚位移，积分在材料坐标上进行，弱形式为虚功原理。
    2. U.L.中变分项为虚速度，积分在空间坐标上进行，弱形式为虚功率原理。

30. 弱形式使用有限元进行离散后，如果是动力学问题或者材料为率相关的，则结果为时间相关的ODEs，此时也成为半离散；否则结果为非线性方程组，此时为全离散。
31. 工程应变=$\varepsilon(X,t)=F(X,t)-I=\frac{\partial u}{\partial X}$。当$t=0$时，$\varepsilon(X,0)=0$。
30. 位移和变形的关系：变形可以看作是位移的导数，因此大变形和大位移并没有必然的联系。
    1. 鱼竿受力时，为大位移+小变形，需要鱼竿弯曲较为明显时才可以。
    2. 悬臂柱偏心受压，柱顶侧向位移不需要很大时，轴力产生的弯矩就不可忽略，即P-Δ效应。和鱼竿受力的区别在于，前者的位移和荷载可以认为是线性的，即使在大位移的情况下，而后者是非线性，即使位移不大的情况下。
    3. 蹦床受力，挠度大时会产生薄膜应力，该应力向上的分量不可忽略，为大位移+大变形。
40. 在非线性体系中，唯一性定理和叠加原理不成立。
41. 几何非线性问题，都需要在变形后的构型上建立平衡方程。但是变形后的构型正是待求的，可以逐步加载，例如将荷载分为10份，产生10个荷载的增量，在未变形构型上施加第一个荷载增量，计算出第一个位移增量，每次都在前一个变形构型的基础上增加荷载增量，然后计算位移增量。这个相当于有一个随时间变化的动力荷载，不过这个荷载不考虑惯性效应。
42. 位移增量的计算方法：只能先假定一个可能的位移增量，该位移在平衡方程中会产生残差，然后使用加权残差法平差，然后再检查残差是否满足标准，即不平衡力的相对值，位移的变化值是否收敛。
43. 上一步加载的不平衡力可以在几次迭代后，加入到下一步荷载中。
44. 线弹性材料是弹性材料的细分，弹性指的是，荷载撤去后变形可以完全恢复。线性指的是，应变张量和应力张量呈线性关系。
45. 线弹性体除了要求材料是线弹性外，还要求结构是连续体，且满足胡克定律$u=a_1F_{P1}+a_2F_{P2}+\cdots+a_nF_{Pn}$。$u$为任意一点位移，$a_i$为常系数，$F_{Pi}$为荷载。这意味着小变形，大位移的情况也不是线弹性体。胡克定律一种解释是宏观的，就是位移和荷载呈线性关系。另一种解释是围观的，应力和应变呈呈线性关系。
46. 结构力学中的叠加原理适用于线弹性体。
48. 虚功原理是最小作用量原理在力学系统中的应用。
49. 作用量是一个标量，描述了系统的能量如何随时间变化。例如一个简单的粒子以恒定速度运动，作用量就是粒子的动量和位移的内积。等价于动能的2倍乘以它拥有这个能量的时间，单位是$J\cdot s$，和角动量单位一样。对于复杂的系统，可以看作是粒子的集体，将每个粒子的作用量加起来就是整个系统的。
50. 从数学上说，作用量是一个关于路径或轨迹的泛函，一般是一个物理量（速度或动量）沿路径的定积分，值为一个实数。也可以表述为关于时间的积分，粒子在这个时间范围内沿着路径运动。因此平稳作用量原理是一种变分原理。
51. 在拉格朗日力学中，作用量中的被积函数为拉格朗日量。该作用量的变分为0会导出欧拉-拉格朗日方程。
52. 哈密顿原理是平稳作用量原理的一个特殊例子。最小作用量原理最早的例子是光在介质中沿直线传播，和入射角等于反射角，这两个例子中光都是选择最短路径或时间作为真实的行为。
54. 广义坐标所在的空间称为位形空间（Configuration Space），该空间中的一个点对应多个广义坐标的值，决定了系统的一种位形。
    1. 单个粒子的位形空间是$R^3$。
    2. 一个刚体的位形空间是$R^3\times SO(3)$，其中$R^3$为附着于刚体的坐标原点的坐标，$SO(3)$为三维空间的旋转群，每个元素都是一个关于坐标原点的旋转操作，可以将地面坐标系旋转到附着于刚体的坐标系。
    3. 一个由n个刚性连杆组成的机械臂，它的位形空间是$[R^3\times SO(3)]^n$的一个子集，因为机械臂会受到约束，每个连杆并非可以以任意姿态达到任意位置。有时也用末端执行器可以达到的位置来定义它的位形，虽然一个末端位置可以对应多种连杆位形，但是这对于机械臂的操作来说是一样的。
55. 位形空间不足以描述整个力学系统，因为它只描述了粒子的位置，遗漏了速度。位形流形中任意一点的速度矢量的集合定义了一个相切的平面。位置和动量的集合构成了位形空间的余切丛，这个更大的流形被称为系统的相空间。
56. 三维空间中绕原点的旋转操作具备群的特征：满足结合律，有单位元，有逆元。两次旋转可以组合成一次旋转。
57. 旋转操作可以用旋转轴和转动角度来表示，旋转轴有2个自由度，因此旋转操作一共有3个自由度。旋转操作是$R^3$中的线性变换，一旦选定一个基，就可以用一个正交矩阵（由旋转操作保角度和长度可以推出）表示这个旋转操作，这里的群操作就变成了矩阵乘法。
58. 同时由于旋转操作还保方向，即空间的左右手的方向，例如将2个向量$\vec{c}=\vec{a}\times\vec{b}$，分别旋转，需要保证旋转后的向量仍然满足这个关系。因此只有行列式为1的正交矩阵才是旋转操作。所有的三阶正交矩阵可以构成一个群，为O(3)，orthogonal group。而旋转矩阵是特殊的正交矩阵，因此记作SO(3)，special orthogonal group。
59. 三维空间的旋转不满足交换律，因此是非阿贝尔群，而二维空间的旋转操作就是阿贝尔群。例如在三维空间中，点(1，0，0)先绕x轴转90，再绕y轴转90的结果为(0，0，-1)。而先绕y轴转90，再绕x轴转90的结果为(0，1，0)，结果不同。对于二维空间中的点，只能绕z轴旋转，很容易发现，它是可交换的。
60. 最小作用量原理也被称作平稳作用量原理，实际上不一定要求是最小。只需要作用量这个泛函的一阶变分为零。
72. 将最小作用量原理运用到力学系统的作用量时，会得到系统的运动方程，例如牛顿，拉格朗日，哈密顿方程，甚至广义相对论（作用量为Einstein-Hilbert 作用量），经典电动力学和量子场论中的方程（路径积分方程）。

# 微分几何

## 集合论

1. $R^2\equiv R\times R$，三横表示记作。$\times$为两个集合的笛卡尔积。$R^n$集合中的元素$x$天生就有$n$个坐标$(x^1,x^2,\cdots,x^n)$，称为自然坐标。任意两个元素也可以计算它们之间的距离$|y-x|=\sqrt{\sum_{i=1}^2(y^i-x^i)^2}$。这些属性都是$R^n$特有的，天生的结构，自然度量，一般的集合是不具备这种性质的。
2. 给定两个集合，可以讨论他们之间的映射。$f:X\to Y$表示$f$是$X$到$Y$的一个映射，当且仅当对于$X$中任意一个元素$x$，都有$Y$中的一个元素$y$与之对应。$y$称为$x$的像，因此$x$也成为$y$的逆像。$f:x\mapsto y$。
3. 特殊性质的映射：
   1. 1-1，也就是任意$y$的逆像个数$\le$1。即单射。
   2. onto（到上），任意$y$必定有逆像，也就是个数$\ge$1。即满射。
4. 同时满足单射和满射则是一一映射或双射（Bijection）。

## 连续性

1. 记号$C^n$为n阶导数存在并连续，$C^0$是指函数本身连续。
2. 一元函数$f$，在区间上连续等价于在区间的每一点都连续（可以用$\varepsilon-\delta$语言定义）。在某一点连续，首先需要在该点存在函数值。
3. $f$在$x_0$点连续的$\varepsilon-\delta$定义为：如果对于$\forall \varepsilon>0$，$\exist \delta>0$，使得当$|x-x_0|<\delta$时，$|f(x)-f(x_0)|<\varepsilon$。
4. 上述定义不能直接推广到一般的集合中，因为需要定义两个集合上元素的距离。可以用开区间的并来重新给出定义：$f:X\to Y$是$C^0$，如果$Y$的任意开区间的（并的）逆像总是$X$中的开区间的并。
5. $Y$中区间的逆像就是该区间内任一点的逆像的集合。在这里一个元素的逆像可以有多个。因此区间的逆像可能为空集。B的逆像A的定义为：$A=f^{-1}[B]:=\{x\in X|f(x)\in B\}$​。
6. 对于1-1和onto的映射才可以定义逆映射，$f^{-1}:Y\to X$。

## 拓扑空间

1. R上的开区间的并经过抽象之后，就成为一般集合上的开集或开子集。将$R$中所有能写成开区间的并的子集称为开子集，否则称为非开子集。讨论开集要先定义全集，因为它是满足某些性质的子集。
2. 只有在集合$X$上定义了拓扑结构后，才可以询问$X$的子集是否是开集。或者说，为一个集合指定拓扑就是选定了一些子集，将这些子集标记为开集。
3. 可以使用两种方法来定义一个拓扑，无论如何，拓扑集合$\mathscr{T}$都是集族（family），即$\mathscr{T}$的元素都是$X$的子集：
   1. $X$的幂集$2^X$的一个子集。
   2. $X$的子集作为元素构成新的集合。
4. 首先创建$X$的幂集，即用它的所有子集作为元素，构造一个新的集合。在幂集中再选定一个子集$\mathscr{T}$（花体的T，表示topology的意思），认为这个子集中的元素都是$X$的开集，这样定义了一个拓扑。当然这个幂集的子集不能随便选，选法有相当任意性，但不完全自由。因为拓扑集还需要满足以下三条性质：
   1. $X$和$\varnothing$都$\in \mathscr{T}$。
   2. $\mathscr{T}$中有限个元素$O_i\in \mathscr{T},i=1,\cdots,n$的交$\bigcap O_i\in \mathscr{T}$，还在$\mathscr{T}$中。$\mathscr{T}$中的每个元素都对应于$X$的一个子集，因此可以取并和交。
   3. $\mathscr{T}$中任意多个元素$O_\alpha\in \mathscr{T},\forall \alpha$的并$\bigcup O_\alpha\in \mathscr{T}$，还在$\mathscr{T}$中。当$X$是无穷集合时，其幂集$2^X$自然也是无穷集族，因此拓扑有可能是无穷集族。
5. 上面的第2个条件，不可以是“无限个元素的交也是开集”，例如$(0,1+1/n)$这样的无限个集合，都是开集，但是他们的交集$(0,1]$却不是开集。$(0,1]$之所以是他们的交，因为该集合包含于上述每个集合。
6. 选定$X$中不同的子集，就定义了不同的拓扑。
7. 定义了拓扑结构的集合，称为拓扑空间$(X,\mathscr{T})$，其中$X$为底集，$\mathscr{T}$称为拓扑，同一个底集上可以定义不同的拓扑结构，来构成不同的拓扑空间。拓扑空间中的元素都是$\mathscr{T}$中的元素。因此定义拓扑就等价于定义开集。
8. 两个特殊的拓扑空间：
   1. 离散拓扑：拓扑集就是$X$的幂集，是元素最多的拓扑空间，因为包含了$X$的所有子集。
   2. 凝聚拓扑：拓扑集中只有两个元素就是$X$本身和空集$\varnothing$，是元素最少的拓扑空间。
9. $R^n$的通常（usual）拓扑$\mathscr{T}_u:=\{x\subset X|x可表示为开球的并(并不限制数量) \}$，它就是$R^n$默认使用的拓扑。以$x_0$为中心，半径为$r$的开球：$B(x_0,r):=\{ x\in R^n||x-x_0|<r\}$，开球的定义需要使用到欧几里得空间的度量来定义，它也是$R^n$上的自然度量。$R$上就是开区间，$R^2$上就是开圆盘，$n\ge3$时统称为开球。
10. 因此可以发现之前定义的$R$中开区间的并就是$R$的通常拓扑意义下的开集。这也是上述拓扑被称为通常拓扑的原因。
11. R中的任意开区间的并对于凝聚拓扑空间不是开集，因为凝聚拓扑空间只有2个元素，并不包含任意的开区间，对于离散拓扑空间是开集，因为任意开集都是离散拓扑空间中的元素。
12. 例子：
    1. $X=\{1,2,3,4\}$，则凝聚拓扑空间为$\mathscr{T}=\{X,\varnothing\}$。
    2. 集族$Y=\{\varnothing,\{2\},\{1,2\},\{2,3\},\{1,2,3\},X \}$构成$X$的一个拓扑，可以逐条验证，第一条自然满足，第二条也满足，因为有限多个元素的交确实还是$Y$的元素，第三条也满足，因为任意多个元素的并确实还是$Y$的元素。
    3. $R^2$中的线段不是通常拓扑意义下的开集，因为它不能表示为开圆盘的并。因为任意的开圆盘都会包含到线段外的点。
13. 现在考虑如何为$X$的子集$A$定义拓扑，如果定义新的拓扑$(A,\mathscr{S})$，能够使得如果$A$的子集$V$是$\mathscr{T}$的元素，那么它也是$\mathscr{S}$的元素时，即$X$中的开集也是$A$中的开集，$\mathscr{S}:=\{V\sub A|V\in \mathscr{T}\}$。那么认为这样的定义是比较好的，但是这并不总是能办到，当$A$是$X$的开集时，可以办到，如果$A$不是$X$的开集，则办不到，因为无论如何定义A的拓扑，A自身一定是该拓扑下的开集。
14. ![image-20231110194745360](有限元.assets/image-20231110194745360.png)
15. 一个非常巧妙地定义为：设有拓扑空间$(X,\mathscr{T})$，$X$的一个子集$A$上可以定义一个特殊拓扑$\mathscr{S}:=\{ V\subset A|\exist O\in\mathscr{T} s.t. O\cap A=V\}$。即$A$中的开集为可以表示为$X$中开集和$A$本身的交的集合。这个称为$\mathscr{T}$的诱导拓扑，$(A,\mathscr{S})$为$(X,\mathscr{T})$的拓扑子空间。
16. 例如：$X=R^2$，取通常拓扑，$A$为其上的一个圆周，取对应的诱导拓扑，因此$A$是$X$的子集，但不是开子集（因为任意开子集）。现在取$V$为圆周的一段不带端点的弧，则$V$是$A$的开集，因为可以用一个$X$中的一个开圆盘（不够的话，可以取多个开圆盘）和$A$相交得到$V$。
17. ![image-20231110201526528](有限元.assets/image-20231110201526528.png)
18. 拓扑空间$(X,\mathscr{T})$和$(Y,\mathscr{T}')$之间的映射还可以讨论是否是连续的。$f:X\to Y$是$C^0$，如果$O\in\mathscr{T'}$能推出$f^{-1}[O]\in\mathscr{T}$。注意映射还是底集$X,Y$之间的，而非拓扑集之间的。和实数不同的是，这里相当于直接定义区间的连续性，而非先定义点的连续性，再推广到区间。
19. 拓扑空间之间的映射只能讨论是否是$C^0$，只有定义了微分结构，称为微分流形之后，才可以讨论映射是否是$C^n,n>0$。
20. 如果两个拓扑空间之间存在一个双射$f$，且$f,f^{-1}$都是连续的，则称这两个拓扑空间同胚（homeomorphism），$f$也被称为一个同胚映射。能找到一个即可，而不是任意。互相同胚的两个拓扑空间可以说像的不能再像了。
21. 例如
    1. $R^2$中的一条线段和一个圆之间不同胚，但是想要证明找不到同胚映射却比较麻烦，这时可以利用紧致性来证明。
    2. $R^2$中的圆和椭圆同胚。
22. 将圆在任意点剪断就可以和线段同胚了，反之将线段的两端点粘起来就和圆同胚了，因此拓扑学又被称为橡皮膜上的几何学，即可以任意变形，只要不破坏膜本身。
23. 定义了开集之后还可以随之定义闭集，开集的补集就是闭集，非开集并不等于闭集，例如$R$上的$(0,1]$是非开的，而它也不是闭集，因为它的补也不是开集。根据开集和闭集可以将一个子集划分为4种：
    1. 既开又闭，$R$上的$R$，因为$\varnothing$也是开集。
    2. 非开非闭，$R$上的$(0,1]$。
    3. 只开不闭，$R$上的$(0,1)$。
    4. 只闭不开，$R$上的$[0,1]$。
24. 如果一个拓扑空间中，既开又闭的子集只有2个（即它本身和空集），那么它是连通的。例如对$(0,1)\cup(3,4)$​​来说，除了全集和空集外，$(0,1)也是既开又闭。
25. 还有一种连通，称为弧连通，即任意两点之间存在一个始终在集合内部的连续曲线连接起来。弧连通必定连通。对于流形来说，二者是一样的。

## 紧致性

1. 紧致性：$A\subset X$是紧致的，如果它的任意开覆盖都有有限子覆盖。
2. 开覆盖就是说A包含于X的若干个开集的并。有限子覆盖是指，这若干个开集可以简化为有限个。
3. R中任意开区间或半开区间都不是紧致的，例如半开区间$(1,2]$的一个开覆盖可以是$\{(1+1/n,3)|n\in 自然数\}$，不存在有限个集合的并可以覆盖这个半开区间。
4. R的任意闭区间都紧致。
5. $R^n$的子集是紧致的，当且仅当它是有界闭集。
6. Hausdorff空间或T2空间：若$x,y\in X$，$x\ne y$，$\exist O_1,O_2\in \mathscr{T}$，使得$x\in O_1$，$y\in O_2$，且$O1\cap O_2=\varnothing$。
7. 常见的拓扑空间都是Hausdorff空间。凝聚拓扑空间是一个反例。
8. 对于一般的拓扑空间来说，紧致和闭集并非完全相同。
9. 如果$(X,\mathscr{T})$为Hausdorff空间，$A\subset X$为紧致的，则$A$为闭集。
10. $A\subset R$为紧致的，当且仅当$A$为有界闭集。有界意味着存在一个开球，使得A包含于该开球。
11. 连续映射会将紧集映射为紧集。因此同胚映射保持子集的紧致性。
12. 在同胚映射下保持不变的性质称为拓扑性质或拓扑不变性。紧致性，连通性，Hausdorff性都是拓扑性质，有界性不是。

## 流形

1. 流形（manifolds）的全名是可微流形（differentiable manifolds）或微分流形。
2. 复合映射：$f:X\to Y$，$g:Y\to Z$，复合之后为$g\circ f:X\to Z$，先经过$f$的作用，再经过$g$的作用。
3. 物理学之所以需要流形，是因为研究时需要背景空间，例如牛顿力学研究的是三维欧氏空间$R^3$中物体的运动，电动力学研究的是三维欧氏空间中电磁场，哈密顿力学的背景空间是相空间，狭义相对论的背景空间是$R^4$，三维欧氏空间和一维时间空间。
4. 使用流形，可以规范化物理的表述，用于代替原来的连续统概念。
5. 模糊的定义为：$n$维流形就是局部看起来像$R^n$，整体可以和$R^n$不一样。
6. 首先存在拓扑空间$(M,\mathscr{T})$，如果存在$M$的一个开覆盖（$M$中任意多个开集$\{O_\alpha |O_\alpha\in\mathscr{T} \}$的并，即$M=\bigcup O_\alpha$），并且该开覆盖满足如下2点：
   1. 对于任意$O_\alpha$，均存在一个同胚映射$\psi_\alpha:O_\alpha\to V_\alpha$，其中$V_\alpha$为$R^n$中的一个开集（通常拓扑，也就是开球之并）。潜在要求所有的n均相同。
   2. 如果$O_\alpha\cap O_\beta\ne\varnothing$，那么复合映射$\psi_\beta\circ\psi_\alpha^{-1}$应为$C^\infty$。因为该复合映射是从$R^n$的一个开集$\psi_\alpha[O_\alpha\cap O_\beta]$到$R^n$的另一个开集$\psi_\beta[O_\alpha\cap O_\beta]$的，因此复合映射就是一个n个n元的函数，每个n元函数都是可以判断是否是$C^\infty$，因此该复合映射可以判断是否是$C^\infty$。同理也要求复合映射$\psi_\alpha\circ\psi_\beta^{-1}$是$C^\infty$的。这是光滑流形之所以称为光滑的原因。
7. ![image-20231110220017855](有限元.assets/image-20231110220017855.png)
8. 上面的第1个条件就对应着局部地看起来像$R^n$。第2个条件意味着包含一点的任意多个开集是相容的，又被称为相容性条件，意味着对于一个点的多个坐标系，其坐标之间的变换是光滑的。
9. 微分流形$M$中的任意一点$x_0$，至少存在一个包含它的$(O_\alpha,\psi_\alpha)$，在该映射$\psi_\alpha$下，有一个$R^n$中的像，这个像的坐标$(x^1,x^2,\cdots,x^n)$称为$x_0$在$\psi_\alpha$下的坐标。注意映射不同，坐标可能不同，例如在$\psi_\beta$下，坐标为$(x'^1,x'^2,\cdots,x'^n)$。由于$M$是流形，因此对于这两个映射，存在n个$C^\infty$的n元函数$\phi^i$，$x'^i=\phi^i(x^1,x^2,\cdots,x^n)$，该函数关系就是复合映射$\psi_\beta\circ \psi_\alpha^{-1}$或$\psi_\alpha\circ \psi_\beta^{-1}$，也称为坐标变换。
10. 流形中的一个点是无法谈论坐标的，但是通过$(O_\alpha,\psi_\alpha)$，可以将它和$R^n$中的一个点对应起来，这个点是有自然坐标的。但是不能说这个自然坐标就是流形中该点的坐标，因为这个自然坐标依赖于$(O_\alpha,\psi_\alpha)$，只能将该自然坐标称为流形中该点在$(O_\alpha,\psi_\alpha)$下的坐标。
11. 将$(O_\alpha,\psi_\alpha)$称为一个局部坐标系或图（chart），其坐标域为$O_\alpha$，因为他们联合起来可以为$O_\alpha$中的点赋予坐标，也有叫坐标卡的。将$M$的一个开覆盖$\{O_\alpha\}$的所有图放到一个集合中，可以得到一个图册$\{(O_\alpha,\psi_\alpha)\}$，altlas。对一个拓扑空间定义微分结构就是确定图册。和拓扑结构一样，图册的选择并不唯一。
12. 例子：
    1. 拓扑空间就是$R^2$，元素的自然坐标为$(x^1,x^2)$。然后图册中只有一个图$(O_1,\psi_1)$，其中$O_1=R^2$，$\psi_1$就是恒等映射。这样的拓扑空间是一个2维流形。
    2. 上面的流形，也可以为图册增加一个图，$O_2=R^2-(0,0)$，$\psi_2:r=\sqrt{(x^1)^2+(x^2)^2},\theta=\arctan(x^2/x^1)$。第二个图或坐标系就是极坐标系。为了保证$\psi_2$是同胚映射，需要从$O_2$中排除掉自然坐标为$(0,0)$的点。
    3. $M=(S^1,\mathscr{T})$为二维平面上的一个圆周，拓扑为诱导拓扑，因为可以用角度来刻画其上的点。取一个特殊的开覆盖，上半圆周，下半圆周，左半圆周，右半圆周，都不带端点。其中上下半圆周的同胚映射可以取为向x轴的投影。
    4. $S^2$表示是三维空间中的一个球面，是二维流形，因为可以用经纬度刻画其上的点。
13. 图册中只有一个图的流形，称为平凡trivial流形。
14. sphere是球面，ball是球体。
15. 对同一个拓扑空间选择不同的图册，也可以得到不同的微分流形。如果两个图册中相交的图都是相容的，那么这两个图册可以合并为一个，也就是定义的是同一个流形。否则就说定义了两个流形。因此为了方便，以后说图册都是指最大的那个图册。这样可以任意做坐标变换了。
16. 对于两个微分流形$M$和$M'$（维度可以不同）之间的映射$f$，可以判断在点$p$是否是$C^r$的，当且仅当复合映射$\psi'_\beta\circ f\circ \psi_\alpha^{-1}$是$C^r$的，该复合函数是$n'$个$n$元函数。$f$是$C^r$的，当且仅当它在M的每一点都是$C^r$的。这里不要求f同胚映射。
17. ![image-20231110231952355](有限元.assets/image-20231110231952355.png)
18. 如果两个流形之间存在一个$C^\infty$的映射，且逆映射也是$C^\infty$的，则两个流形是微分同胚（diffeomorphism），该映射也是一个微分同胚映射。可以看到微分同胚包含同胚。易得两个微分同胚的流形必定具有相同的维数。
19. 从$n$维流形到$R$的映射被称为函数，或标量场。选定不同的坐标系，会得到不同的n元函数，但是标量场是唯一的。先将流形中的点映射到$R^n$中，然后将$R^n$中一点映射到R上。两次映射的复合称为标量场，而第二个映射是常说的函数，因此一般不将复合映射称为函数。标量场是绝对的，而函数是相对的。
20. $f(x)=F(\psi(x))$。等号左端是标量场的定义，等号右端是复合映射，$F(x^1,x^2,\cdots,x^n)$是函数。

## 流形上的矢量

1. 一个集合加上加法映射为$f:V\times V\to V$和数乘映射为$g:R\times V\to V$​。并且满足一些特殊的规则，就构成了一个线性空间。
2. 欧几里得空间中的从一点出发的带方向和大小的箭头可以看作是矢量空间的一个例子。加法使用平行四边形法则，数乘就是方向不变，缩放长度。
3. 而对于一般的流形，无法使用上述方式定义方向和大小，因此不能直接推广。需要借助方向导数来推广，首先构造一个新的集合$\mathscr{F}$，包含流形上所有的光滑标量场，f是其中的一个元素，当点可以沿着某个向量运动时，f的取值也变化，因此可以求得f在该方向上的导数（一个实数）。同理，给定一个方向，对于不同的标量场，都可以求得一个方向导数。这样可以将方向当作一个映射：$\mathscr{F}\to R$，我们将这个映射称为该点的一个向量$v$​。
4. 参照微积分中的定义，这里要求该映射满足线性性质$v(\alpha f+\beta g)=\alpha v(f)+\beta v(g)$和莱布尼兹律$v(fg)=fv(g)+v(f)g$。
5. 标量场的乘积/加法也是一个标量场，结果在同一点的值是原来两个标量场在该点的值的乘积/加法。可以交换顺序。
6. 可以证明，该点的所有向量构成一个向量空间，维数和流形的维数相同。加法定义为：$(v+u)f=v(f)+u(f)$，数乘定义为$(\alpha v)f=\alpha v(f)$​，零元定义为$\underline{0}(f)=0$。
7. 可以看到这里的向量就是一个泛函。
8. 有了矢量空间中就可以寻找基矢量，这里选择一个和坐标系相关的基矢量。对于一点p，有一个图$(O_\alpha,\psi_\alpha)$，这样该点就有坐标系了，对于任意的标量场$f$，都会产生一个函数$F(x^1,\cdots,x^n)$。定义$n$个矢量的作用效果为$X_i(f)=\frac{\partial F(x^1,\cdots,x^n)}{\partial x^i}|_p$​​​，即偏导数在p点的值。可以发现这个n个矢量能构成该向量空间的一个基底。
9. 当$x^\mu$出现在分母时，虽然是上标，但是会被当作下标。
10. 一般将上述的基矢量称为坐标基底，因为它是和坐标系相关的。任意一个矢量$v$可以分解为$v=v^\mu X_\mu$，$v^\mu$称为坐标分量。
11. 一种简洁的写法是$X_i=\frac{\partial}{\partial x^i}$。这里不会引入歧义，因为分母出现了$x^i$​，就表明已经定义了坐标系了。所以分子的偏导符号将来是要作用到标量场在该坐标系下的函数上的。
12. 给定了坐标系后，n维流形中的一点，也会得到n个坐标，每个坐标都可以看成一个光滑的标量场，每点的取值为该坐标值。用上边的基矢量作用到这个场中可得：$X_\mu(x^\nu)=\frac{\partial x^\nu}{\partial x^\mu}=\delta_\mu^\nu$。
13. 对于同一个点的矢量空间，可以选择不同的坐标系，得到不同的坐标基底，它们之间有如下关系：$X_{'\nu}=\frac{\partial x^{\mu} }{\partial x^{'\nu}}X_\mu$，这个是通过坐标基底的定义和复合函数求导得到的。除此之外，坐标分量$v^\mu,v^{'\nu}$之间也有类似的关系$v^{'\nu}=\frac{\partial x^{'\nu}}{\partial x^\mu}v^\mu$。变换的系数是偏导数的值，可以由坐标变换来获得。
14. 很多张量分析的书中，使用此式作为矢量的定义，即坐标变换下分量满足某种变换关系，这个比上面的定义要具体一些，但是应用面就不够广。
15. 流形中的曲线：$C:I\to M$，定义为一个$C^r$类映射，将R的一个区间，映射到流形中的一些点，此时称C为$C^r$类曲线，一般情况下讨论的都是光滑曲线。和传统定义不同的是，传统定义会将M中的一系列点的连线（只有像）当作曲线，而流形的定义是将该映射本身（既包含源，又包含像，也包含映射关系）当作一条曲线。
16. 区间中一点的值t，称为像点$C(t)$的参数。如果使用传统定义，则曲线上一点的参数是未定义的，可以任意。而使用流形定义时，映射本身规定了像点的参数值。这种曲线称为参数化的曲线。流形中的曲线可以重参数化，即映射C的像不变，改变源$I$或者映射关系。
17. 如果在曲线上某点选定一个坐标系，则根据该曲线可以确定n个一元函数，从曲线的参数t，分别映射到像点的n个坐标值$x^\mu$。这个称为曲线的参数方程$x^\mu(t)$。
18. 参数曲线$C$上，参数为$t_0$的点的切矢量定义为：$T(f):=\frac{d(f\circ C)}{dt}|_{t_0}$。其中$f\circ C$是从参数$t$到标量场取值范围$R$的一元函数，因此可以令其对$t$求导。简化点可以写为$T(f):=\frac{df(t)}{dt}$，因此记$T=\frac{d}{dt}$或$\frac{\partial}{\partial t}$。
19. 给定坐标后，流形上有一系列的特殊曲线，即坐标曲线，曲线上的点的n个坐标值，只有一个在变化。可以证明坐标曲线在该点的切矢量就是该点的一个坐标基矢量。
20. 一个n维流形中，特殊的子流形有两类，一个是1维的曲线，一个是n-1维的超曲面。
21. 流行中过一点的任意曲线的切向量$\frac{\partial}{\partial t}$都在该点的不同坐标基矢量上分解，给定一个坐标系，就有一组坐标基底，就能获得一个分解。$\frac{\partial}{\partial t}=\frac{d x^\mu}{d t}\frac{\partial}{\partial x^\mu}$。等号右侧第一项是可以由曲线的参数方程求导获得。这也是一个复合函数的链式求导法则。综上：曲线的切矢量的坐标分量为曲线的参数方程的导数。
22. 可见曲线重参数化后，切矢量的方向不变，只是大小变化，也有可能反向。$\frac{\partial}{\partial t}=\frac{d t'}{d t}\frac{\partial}{\partial t'}$。
23. 流形中过一点的曲线和该点的切空间的一个元素一一对应。切空间中的元素称为切矢量。曲线在该点的切矢量就是切空间中的该元素。
24. 给定流形中过一点的曲线$C(t)$，就能找到该点一个矢量与之对应（例如曲线在该点的切矢量，但不唯一），反之亦然（也不唯一，例如在一点相切的多条曲线）。因此可以称该点的矢量空间中任意一个元素都是切矢量，故而可以称该矢量空间为切空间。
25. 流形上的矢量场，即M中的每一点都对应一个矢量。也可以对于流形的子集定义矢量场，例如流形中的曲线，可以将切矢量作为矢量场。注意这里的曲线不是映射C，而是C的像。因为场的取值只和流行中的点有关，而和曲线的参数无关。还有这里要求曲线不是自相交的，否则会造成一点的切矢量不唯一。
26. 另一个例子是，超曲面上每点的法矢量，也构成一个矢量场。
27. 矢量场用$v$表示，该场在p点的取值为矢量$v|_p$。
28. 对于一个固定的标量场f，可以将流形中每点的矢量$v$作用在该标量场上，得到一个属于该点的标量值，这样就得到了一个新的标量场$v(f)$，满足$v(f)|_p=v|_p(f|_p)$。因此可以认为该标量场在矢量场的作用下发生了运动。
29. 可以通过$f$和$v(f)$的光滑性来定义$v$的光滑性。如果$f$和$v(f)$都是光滑的，则说$v$也是光滑的。标量场的光滑性可以通过两个流形间的微分同胚来检验。默认，矢量场都是光滑的。
30. 考虑两个矢量场$u,v$，对于任意一个标量场$f$，如果$u(v(f))=v(u(f))$，则称这两个矢量场对易。
31. 定义关于$u,v$的对易子$[u,v]$，它是一个矢量场，它作用在标量场$f$的结果为$[u,v](f)=u(v(f))-v(u(f))$，可以验证它满足线性性和莱布尼兹律。这个类似于Lie括号。
32. 常见对易的两个矢量场为：不同的坐标基矢场之间互相对易，即$[\frac{\partial}{\partial x^\mu},\frac{\partial}{\partial x^\nu}]=0$，这个可以通过偏导数可交换来证明。这个性质是坐标基矢场的特性，普通基矢场不具备。
33. 积分曲线：如果一条曲线$C(t)$在其上每点的切矢量$\frac{\partial}{\partial t}|_p$都和一个矢量场$v$在该点的取值$v|_p$相等，则称该曲线为矢量场的积分曲线。类似于流线。
34. 给定一个矢量场$v$，对于流形中的某点p，总是可以找到过该点的唯一一条积分曲线。找曲线的工作等价于找n个参数方程$x^\mu(t)$。将$v|_p$在p点的坐标基底上分解：$v|_p=v^\mu \frac{\partial }{\partial x^\mu}$。同时曲线的切矢量为$\frac{\partial }{\partial t}=\frac{d x^\mu}{d t}\frac{\partial }{\partial x^\mu}$，联立这两个方程可得$\frac{d x^\mu}{d t}=v^\mu$，这是n个的1阶常微分方程，为了求解，还需要配以初始条件，可以令p点（坐标为$x^\mu(p)$）对应的曲线参数为$t_0$。
35. 群可以看作是集合上的结构，它和拓扑结构互不隶属。群乘法是一个映射$G\times G\to G$。需要满足三条要求：
    1. 交换律$g_1(g_2g_3)=(g_1g_2)g_3$​，因此可以不写括号。
    2. 存在恒等元$e$，对于任意$g$，满足$eg=ge=g$。
    3. 对于任意$g$，都存在唯一的逆元，记作$g^{-1}$，满足$gg^{-1}g^{-1}g=e$。
36. 物理学之所以引入群论，是因为它是研究对称的利器。如果某个对象在一个变换下保持不变，则称该对象具有在改变换下的对称性。
37. 举例：均匀带电无限平面，电荷面密度为$\sigma$。其上一点p坐标为$(x,y,z)$，将该点沿x轴正向平移c长度，得到p'点，坐标为$(x+c,y,z)$。由于均匀性，可知$\sigma(x,y,z)=\sigma(x+c,y,z)$。可以看出$\sigma$在沿x轴平移变换下保持不变，因此$\sigma$具有沿x轴方向的平移对称性。点变换可以看作一个映射，将$R^3$中的一个点映射为$R^3$中的另一个点，记作$\phi_a:=R^3\to R^3$，$a$是这个映射的参数。可以发现这个映射是1-1 onto，正反$c^\infty$，即它是微分同胚映射。同时全体平移映射的集合$\{ \phi_a|a\in R \}$，构成一个群，群乘法为$\phi_a\phi_b=\phi_{a+b}$，恒等元为$\phi_0$，逆元为$\phi_a^{-1}=\phi_{-a}$。
38. 上面的群称为单参微分同胚群，即群内每个元素都是一个微分同胚的映射，只需要一个参数就可以生成群内的所有元素。
39. 流形M上的单参微分同胚群还可以定义为映射$\phi:=R\times M\to M$。如果固定第一个变元，可得$\phi_t=M\to M$，要求$\phi_t$是M到M的微分同胚映射，因此第一个变元即为参数。如果固定第二个边缘，可得$\phi_p=R\to M$，即M中的一条曲线，一定过p点，参数值为0，因为$\phi_p(0)=\phi(0,p)=\phi_0(p)\mapsto p$，因为$\phi_0$是群的恒等元。
40. 第一种定义更容易理解，而第二种定义还可以派生出一种特殊的情况，就是对于每一点都有一个曲线。
41. 给定M上的一个单参微分同胚群，就可得到M上的一个矢量场。这里可以利用单参微分同胚群的第二种定义，固定第二个变元为M上的一点p，可得一个过p点的曲线，可以求得在p点的切矢量，这样相当于给定一个点，得到一个矢量，于是得到M上的一个矢量场。
42. 上述命题，反之也成立，矢量场可以得到无数条积分曲线，对于给定的参数t，可以认为该微分同胚映射是将流形中的点，沿着过该点的积分曲线运动，前后两点的参数值之差为t。
43. 矢量场中任意一个点都有一条曲线与之对应，这样可以认为无数条1维的曲线把n维的流形覆盖了。
44. 矢量空间$V$的对偶也是一个矢量空间$V^*$。其中的元素都是$\omega:=V\to R$的线性映射，$\omega$称为$V$上的一个对偶矢量。$V$和$V^*$的维数相同。
45. 选定V的一组基底$e_i$之后，就可以同时确定$V^*$的一组基底$e^{j}$，它们之间满足$e^{j}(e_i)=\delta_i^j$​。这样的基底是互相对偶的。
46. 使用对偶基底对矢量和对偶矢量进行分解：$v=v^\mu e_\mu=e^{\mu}(v)e_\mu$，$\omega=\omega_\mu e^{\mu}=(\omega(e_\mu))e^{\mu}$。
47. 使用对偶基底可以将$V^*$中的矢量$\omega$作用在$V$中的矢量$u$的结果$\omega(u)$简化表示，分别将二者在各自的基底下展开，得到$\omega(v)=\omega_\mu v^\mu$。
48. 两个线性空间像的不能再像称为同构，两个群像的不能再像也称为同构，为了区分，后者一般称为群同构。
49. 同构映射：1-1，onto，保持线性。这里无法谈论是否连续光滑，因为没有定义拓扑。
50. 映射保持线性意味着：线性组合的映射等于映射的线性组合。$f(\alpha u+\beta v)=\alpha f(u)+\beta f(v)$。
51. 两个线性空间同构的充要条件是它们的维数相同。
52. 矢量空间和其对偶空间是同构的，这样的同构映射有很多，但是有一类特殊的，就是$f(e_\mu)=e^\mu$，在这些中，随着基底选择的不同，也会有不同的同构映射。
53. 自然同构：$V$的对偶空间$V^*$，也存在对偶空间$V^{**}$，可知$V$和$V^{**}$也是同构的，它们之间就存在一个特殊的同构，称为自然同构。$V$中元素$v$在$V^{**}$对应的那个元素$v^{**}$，要满足如下关系：$v^{**}(u^*)=u^*(v)$，其中$u^*$是$V^*$中的任意一个矢量。
54. 因此可以认为$V$和$V^*$是完全一样的。于是认为矢量也可以作用于对偶矢量上：$v(u^*)=u^*(v)$。因此就没有必要继续寻找$V^{**}$的对偶空间了。
55. 矢量空间可以选择2个不同的基底$e_\mu$和$e'_{\nu}$，因此也自然得到2个对偶基底$e^\mu$和$e'^{\nu}$。矢量空间的基底之间可以互相表示：$e'_{\mu}=A^\nu_{\hspace{0.5em}\mu} e_{\nu}$。因此对偶基底也可以互相表示：$e^{'\mu}=(A^{-T})^{\hspace{0.5em}\mu}_\nu e^{\nu}$​。
56. 需要注意的是这里的A的标记分为上下标和前后标，上下是为了区分协变和逆变，前后是为了使得A可以表示成一个矩阵时区分行列，前标表示行号，后标表示列号。一般将所有的上标都写在下标的前面。
57. 流形上的对偶矢量场：M中任意一点p都有一个切空间，这个切空间存在对偶空间，因此可以定义流形上的对偶矢量场。注意每点的矢量和对偶矢量之间没有关系，他们的基底之间可以是对偶的。
58. 切空间的对偶空间称为余切空间，余切空间内的元素称为余切矢量。
59. 根据自然同构的定义，可以将标量场$f$和对偶矢量场等同起来，将后者记为$df$。它的定义为：$df(v)=v(f)$。等号右边是方向导数，因此左侧也是。
60. 在流形M的p点选定坐标系，坐标为$x^\mu$，则坐标基矢量为$\frac{\partial}{\partial x^\mu}$，而每个$x^\mu$本身也可以看作是流形上的标量场，因此和他自然同构的对偶矢量为$dx^\mu$，可以证明这个对偶矢量为对偶空间中和$\frac{\partial}{\partial x^\mu}$对偶的坐标基矢量，$dx^\mu(\frac{\partial}{\partial x^\nu})=\frac{\partial x^\mu}{\partial x^\nu}=\delta^\mu_\nu$​。
61. 因此对偶矢量也可以在对偶坐标基矢量上分解：$\omega=\omega_\mu dx^\mu$。
62. 这样给定一个坐标系后，切空间的坐标基矢量可以得到，对偶空间的坐标基矢量也可以获得，二个向量组按照上面的定义是对偶的。
63. 之所以用$df$表示对偶矢量，并非是符号不够用。有多元函数的全微分公式：$df=\frac{\partial f}{\partial x^\mu}dx^\mu$。这个公式对于流形上的标量场$f$也是成立的，该式是对偶矢量的等式，可以让它作用到矢量$\frac{\partial}{\partial x^\nu}$上，验证即可。这个式子可以看成是将任意对偶矢量在对偶坐标基矢量上分解。
64. 不同的是等号左侧的f为标量场本身，右侧的f为场在坐标系下的多元函数表示。
65. 从这个角度来理解，能够以更高端的视角来观察欧氏空间的微积分。

## 流形上的张量

1. 线性空间上的张量，定义为一个多重线性（multi linear）映射：$T:=V^*\times\cdots \times V^*\times V\cdots\times V\to R$，其中$V^*$有k个，$V$有l个。T称为V上的$(k,l)$型张量。

2. 多重线性是指对于每一个槽，都是线性的。

3. 定义张量只需要矢量$V$和对偶矢量空间$V^*$就够了，没必要对偶对偶矢量空间$V^{**}$。

4. 矢量可以看作$(1,0)$型张量，对偶矢量可以看作$(0,1)$型张量。

5. 对于一个$(1,1)$型张量，如果固定第二槽位，则该张量变成$(1,0)$型的张量，也就是一个矢量。因此一个$(1,1)$型张量可以看作为从矢量到矢量的映射，反过来也可以认为是从对偶矢量到对偶矢量的映射。

6. 这是使用映射来定义张量所独有的优点，称之为张量面面观。

7. V上的全体$(k,l)$型张量构成一个线性空间$\mathscr{T}_V(k,l)$，维数为$n^{k+l}$，其中$n$是V的维数。

8. 可以使用$V$和$V^*$中的基底和对偶基底的张量积来构造张量空间的基底：

9. V上的$(k,l)$型张量$T$和$(k',l')$型张量$T'$的张量积$T\otimes T'$是$(k+k',l+l')$型张量，定义为：

10. $$
    T\otimes T'(\omega^1,\cdots,\omega^k,\omega^{k+1},\cdots,\omega^{k+k'};v_1,\cdots,v_l,v_{l+1},\cdots,v_{l+l'})=T(\omega^1,\cdots,\omega^k;v_1,\cdots,v_l)\cdot T'(\omega^{k+1},\cdots,\omega^{k+k'};v_{l+1},\cdots,v_{l+l'})
    $$

11. 由于$\omega$的下标一般用于表示坐标，因此使用商标表示多个对偶矢量的编号，对于矢量正好相反。

12. 一般来说，张量积不满足交换律，但是存在特例：$\omega\otimes v=v\otimes \omega$。

13. 并矢就是张量积。

14. 举例：一个$(2,1)$型张量在基底下的展开$T=T^{\mu\nu}_{\hspace{1.5em}\sigma} e_\mu\otimes e_\nu\otimes e^{\sigma}$。其中$T^{\mu\nu}_{\hspace{1.5em}\sigma}=T(e^\mu,e^\nu,e_\sigma)$。

15. 与张量积作用相反的是缩并，它会降低张量的阶数。

16. 接上面的讨论，一个从$V$到$V$的映射或者说$(1,1)$​型张量可以看作是V上的一个线性变换，它是绝对的，不依赖于坐标系的选择。如果给定了坐标系，则该张量的分量可以构成一个矩阵，线性变换就可以使用矩阵乘法来完成。变换基底时，得到的两个矩阵相似，不一定是正交（酉）相似。

17. 两个相似矩阵的迹是相同的，因此可以将它们作为张量的迹，这是一个张量不变量。

18. $(1,1)$型张量的迹是高阶张量缩并的特例。$(k,l)$型张量的缩并需要指明第i个上槽和第j个下槽，结果为$(k-1,l-1)$型张量，记作$C^i_jT$，对于$(1,1)$型张量，可以省略i，j不写。选取不同位次的上下槽得到的张量一般不等，除非张量本身满足某些对称性。

19. 存在如下等式：$C(v\otimes \omega)=\omega(v)$。从中可以总结出：先积后并=作用。这样就可以用张量积和缩并定义张量对张量的作用了。

20. 下面将线性空间的张量推广到流形上。张量的底空间就是流形的切空间。

21. 线性空间$V$上的度规张量$g$是一个$(0,2)$型张量，要满足如下条件：

    1. $g$是对称的，$g(v,u)=g(u,v)$。

    2. $g$是非退化的，如果对于任意$u$，都有$g(u,v)=0$，则$v=\underline{0}$。结合上一条，可知调换$u,v$的顺序也成立。

22. 度规张量$g$是非退化的等价于它在任意坐标系下的矩阵表示也是非退化的，即矩阵的行列式非0。

23. 如果为线性空间$V$附加了一个度规张量$g$，则构成度规空间$(V,g)$。注意这个和点集拓扑中的度规空间（距离）不太一样，后者是给定了集合中两点的距离。

24. 度规和内积类似，但是不同，因为内积一定是正定的，即$v\cdot v\ge 0$当且仅当$v=0$。而度规不要求，g(v,v)$可以任意取值。

25. 指定度规后，就可以谈论线性空间中向量的长度$|v|=\sqrt{|g(v,v)|}$，因为度规不一定为正，因此需要加绝对值再开根号，和向量间是否正交了$v\perp u \iff g(v,u)=0$。

26. 因此正交或正交归一的基底需要给定度规后才可以确定。同时由于度规不一定是正定的，因此单位矢量的自度规，可能是$\pm1$。

27. 可以证明，对于任意度规张量，总是可以找到一组标准正交基，即$\mu=\nu$时，$g(e_\mu,e_\nu)=\pm1$，否则为0。而这个就是度规张量在该坐标系下的分量构成的矩阵。矩阵是对角的，对角线上的元素是1或-1。可以证明更换其他的标准正交基不会改变1和-1的个数，因为度规张量的迹是不变量，而它就是对角线元素的和。

28. 如果对角元素都是1，则称之为正定度规，如果都是-1，则称之为负定度规，其余的称为不定度规。不定度规中有一个特殊的，即只有一个-1，称之为洛伦兹度规，相对论中会用到。

29. 正定度规也称之为黎曼度规。内积定义的度规是正定度规。

30. 对于洛伦兹度规$g$，和一个矢量$v$，如果$g(v,v)$

    1. $>0$，则称之为类空矢量spacelike。
    2. $=0$，则称之为类光矢量lightlike，也成为null。
    3. $<0$，则称之为类时矢量timelike。

31. 需要注意，不能将类光矢量称为零矢量，因为它是线性空间中的特定元素，而类光矢量可以有很多，依赖于度规的选择。

32. 之前说到对于向量空间和它的对偶空间之间的所有同构映射，不存在那个更特殊。但是如果给向量空间附加上度规，则存在一个特殊的同构映射。例如这里固定$g$的第一个槽为$v$，此时$g(v,\cdot)$为一个对偶矢量，因此g可以看作是$V\to V^*$的映射。度规张量的非退化性，保证了它作为映射是1-1的，而onto和线性自然成立。

33. 注意，度规只是定义在向量空间上的，对偶空间上并不存在度规，即$g(\omega,\sigma)$是无意义的。

34. 现在对于流形来定义一个度规，需要在流形的每点都指定度规，因此构成流形上的一个度规场。

35. 有了度规场后，才可以谈论流形上曲线段的长度。

36. $n$维欧式空间就是$R^n$附加上一个欧式度规场。借鉴二维欧式空间中参数曲线段的长度计算方法，来给出流形上曲线段的长度计算方法。

37. 根据勾股定理，线元长度的平方，$dl^2=(dx^1)^2+(dx^2)^2$。右侧提取出$dt^2$，可得$dl^2=[(\frac{dx^1}{dt})^2+(\frac{dx^2}{dt})^2]dt^2$。其中$\frac{dx^1}{dt}$是曲线切矢量$T$的第一坐标分量，因为$\frac{\partial }{\partial t}=\frac{dx^\mu}{dt}\frac{\partial}{\partial x^\mu}$。因此线元长度平方可以写为$dl^2=T^2dt^2$，简化为$dl=|T|dt$。

38. 上面的出的结果非常容易推广到流形上，不过需要根据度规场的类型来分别给出公式。

39. 如果每点的度规都是正定的，那么$l=\int\sqrt{g(T,T)}dt$。

40. 如果每点的度规都是洛伦兹的，那么需要根据曲线上每点的矢量来对曲线进行分类：如果每点$g(T,T)$都是类空的，那么这条曲线称为类空的。类光和类时曲线同理。

41. 类空曲线段长度的定义和正定度规的情况相同，类时曲线段长度的定义需要在g前面加上一个负号，以便开根号不出现复数。对于类光曲线，其长度恒为0。

42. 存在一种特殊的曲线，在不同的点的种类不同，一会类时，一会类空等，这种曲线段的长度没有定义。

43. 可以证明，对曲线重参数化，不会影响它的长度，有一种特殊的参数就是线长参数，此时$dl=dt$。重新选择坐标系也不会改变曲线的长度，因为上面整个过程没有出现坐标系。但是实际计算曲线长度时，需要借助于坐标系。

44. 给定坐标系后，$g(T,T)=g(\frac{dx^\mu}{dt}\frac{\partial}{\partial x_\mu},\frac{dx^\nu}{dt}\frac{\partial}{\partial x_\nu})=g_{\mu\nu}\frac{dx^\mu}{dt}\frac{dx^\nu}{dt}$。因此$l=\int\sqrt{|g_{\mu\nu}dx^\mu dx^\nu|}$。

45. 绝对值符号内可以看作是矩阵的二次型。记$ds^2=g_{\mu\nu}dx^\mu dx^\nu$为线元，因此$l=\int\sqrt{|ds^2|}$。

46. 这里可能会有疑问，认为$ds^2$必定是非负的，其实不然，对于类时曲线来说，它恒为负数。就把它当作一个记号就好了。出现这种记号的原因是，数学家研究微分几何的时候，不考虑洛伦兹度规。$dl^2$始终是非负的，而$ds^2$未必。

47. 流形附加上黎曼度规称为黎曼空间，流形附加上洛伦兹度规称为伪(pseudo)黎曼空间。流形上附加任何度规称为广义黎曼空间。

48. 黎曼空间中最简单的是欧几里得空间，它的底流形是$R^n$，附加的是欧式度规$\delta$。通过给出该度规在某个特定坐标系下的展开来定义它，欧氏空间可以用一个图来覆盖，坐标系就是$R^n$的自然坐标系，其中$e_1=(1,0,\cdots)$。$\delta=\delta_{\mu\nu}dx^\mu\otimes dx^\nu$，等号右侧的$\delta_{\mu\nu}$是克罗内克符号。二维欧氏空间中$ds^2=\delta_{\mu\nu}dx^\mu dx^\nu=(dx^1)^2+(dx^2)^2$。

49. 可以证明欧氏空间的自然坐标基底在欧式度规下是正交归一的。$\delta(\frac{\partial}{\partial x^\alpha},\frac{\partial}{\partial x^\beta})=\delta_{\alpha\beta}$。反之不一定，因为将自然坐标基底平移，旋转，反射后的坐标基底在欧式度规下也是正交归一的。

50. 如果坐标系的坐标基底是正交归一的，那么称之为笛卡尔坐标系。

51. 伪黎曼空间中最简单的是闵可夫斯基空间，底流形也是$R^n$，附加的是闵可夫斯基度规$\eta=\eta_{\mu\nu}dx^\mu\otimes dx^\nu$。

52. 狭义相对论的空间就是四维闵式空间，物理上一般称为四维闵式时空spacetime，数学上都称之为空间。

53. 狭义相对论中存在间隔不变性，其中元间隔就是$ds^2=-dt^2+dx^2+dy^2+dz^2$，这里使用了几何单位制，因此不是$(cdt)^2$。根据相对论的习惯，维度的取值不是1到4，而是0到3。$\eta_{00}=-1,\eta_{11}=\eta_{22}=\eta_{33}=1$。

54. 自然坐标系经历平移，伪转动boost，反射也是正交归一的。伪转动不适用正余弦函数，而使用双曲正余弦函数。这种坐标系称为洛伦兹坐标系或伪笛卡尔坐标系。

## 抽象指标记号

1. 张量的记号一般$T$，但是这里看不出它的类型，用来缩并时也不方便，有些人使用张量的分量$T_{\mu\nu}$来表示张量，但是在方程中使用它时，无法分辨是分量的关系还是张量本身的关系，因为分量等式可能只对某些基底成立。
2. 因此理论物理学家Penrose提出了一种抽象指标记号，类似于分量表示法。用$T^{ab}_{\hspace{1em}c}$表示一个$(2,1)$​型张量。希腊字母的上下标表示分量，每个可以取1到n的数，拉丁字母的上下标表示张量本身，只是占位。
3. 有了抽象指标后，就可以更方便地表示对张量本身的作用，而非指标。
4. 和分量一样，也要求指标平衡，例如$v^a=u^b$是不允许出现的。如果要说明2个矢量相等，可以用$v^a=u^a$或$v^b=u^b$。
5. 可以用抽象指标来方便记录缩并的位置，$T^{ab}_{\hspace{1em}a}$表示一个$(2,1)$型张量的第一个上槽和第一个下槽进行缩并。这里重复指标不表示求和，而是表示缩并。$T^{ab}_{\hspace{1em}a}$只有一个自由上指标，因此它是一个矢量。
6. 还可以表示张量积，省略$\otimes$符号，$T^{ab}_{\hspace{1em}c}S^{d}_{\hspace{0.8em}e}$是一个$(2,1)$型张量和$(1,1)$型张量的张量积，结果为一个$(3,2)$型张量。$T^{ab}_{\hspace{1em}c}S^{c}_{\hspace{0.8em}a}$表示刚才的结果进行2次缩并后的结果，是一个矢量。
7. 带着抽象指标时，张量的顺序可以任意调整，$\omega_a\mu_b=\mu_b\omega_a$都等于$\omega\otimes\mu$。而$\mu\otimes\omega=\mu_a\omega_b=\omega_b\mu_a$，因此可以发现二者不等。
8. 将抽象指标改成希腊字母，就可以得到分量。常用的有2个表达式：$T=T^{\mu\nu}_{\hspace{1em}\sigma}e_\mu\otimes e_\nu\otimes e^\sigma$。和$T^{\mu\nu}_{\hspace{1em}\sigma}=T(e^\mu,e^\nu,e_\sigma)$。完全用抽象指标改写后为：$T^{ab}_{\hspace{1em}c}=T^{\mu\nu}_{\hspace{1em}\sigma}(e_\mu)^a (e_\nu)^b (e^\sigma)_c$和$T^{\mu\nu}_{\hspace{1em}\sigma}=T^{ab}_{\hspace{1em}c}(e^\mu)_a(e^\nu)_b(e_\sigma)^c$。可以发现两种指标都是平衡的。作用改成缩并，张量积符号直接去掉。
9. 所有跟$\delta$有关的：
   1. $\delta^\mu_{\hspace{0.5em}\nu}$，它是一个符号（一堆数的组合），一个矢量的对偶矢量作用到该矢量上的结果。用于线性空间。
   2. $\delta_{\mu\nu}$，也是一个符号（一堆数的组合），描述同一个线性空间的一组正交归一基底，需要给定度规的线性空间。
   3. $\delta=\delta_{\mu\nu}dx^\mu\otimes dx^\nu$，等号左边是欧几里得度规，用抽象指标记为$\delta_{ab}$。
   4. $\delta^a_{\hspace{0.5em}b}$，一个$(1,1)$型张量，也可以看成是$V\to V$或$V^*\to V^*$的恒等映射。$\delta^a_{\hspace{0.5em}b}v^b=v^a$或$\delta^a_{\hspace{0.5em}b}\omega_a=\omega_b$。它具备置换的功能，例如$\delta^a_{\hspace{0.5em}b}T^{cb}_{\hspace{1em}e}=T^{ca}_{\hspace{1em}e}$。他在任意基底下的分量都是$\delta^\mu_{\hspace{0.5em}\nu}$。

10. 度规$g_{ab}$，可以看作是$V\to V^*$的同构映射，因此给定矢量$v^a$，可得对偶矢量$\omega_b=g_{ab}v^a$，因为$g_{ab}$是同构的，因此矢量和它同构的对偶矢量可以使用同一个符号，即$v_b=g_{ab}v^a$。
11. 度规$g_{ab}$是一个同构映射，因此它的逆$g^{-1}$是从$V^*\to V$的映射，通过张量面面观可得，它是一个$(2,0)$型张量，因此记为$(g^{-1})^{ab}$，然而抽象指标本身就可以将他和$g_{ab}$区分开，因此可以简写为$g^{ab}$。类似于上面，也存在$g^{ab}\omega_a=\omega^b$。
12. 此后也不用$u,v$来表示矢量，$\omega,\sigma$来表示对偶矢量了，而是统一使用抽象指标的上下标，$v^a$为矢量，$v_a$​为对偶矢量。
13. 由于$g_{ab}$和$g^{ab}$互逆，因此$g^{cb}g_{ab}v^a=v^c$。这里等号右侧之所以是上标c是为了指标平衡，说明结果是一个矢量，而指标下的v和左侧相同，才说明是同一个矢量。因此$g^{cb}g_{ab}=\delta^c_a$为恒等映射。
14. 度规张量及它的逆，具备升降指标的功能。$g_{ab}T^{cb}_{\hspace{1em}e}=T^{c}_{\hspace{1em}ae}$。将b降低为下标，然后置换成a。虽然等号右侧仍然用T表示张量，但是它和左侧的张量不同，因为他俩的类型都不相同。
15. 还有一个例外，就是在相对论所使用的四维时空中，有时需要单独表示3个空间维度，此时可以使用$i,j,k$，取值为1，2，3，虽然它们也是拉丁字母，但是这里不当作抽象指标。
16. 使用度规张量来对坐标基底进行升降指标：$g_{ab}(\frac{\partial}{\partial x^\mu})^b=g_{\mu\nu}(dx^\nu)_a$。等号右侧的$g_{\mu\nu}$容易被忽略，可以从指标平衡的角度记忆。同理有$g^{ab}(dx^\mu)_b=g^{\mu\nu}(\frac{\partial}{\partial x^\nu})^a$。
17. 如果上面的度规为欧式度规$\delta_{ab}$，坐标系为笛卡尔坐标系，即自然坐标系的平移，转动，反射的集合。此时上面的公式就变成$\delta_{ab}(\frac{\partial}{\partial x^\mu})^b=(dx^\mu)_a$。
18. 如果上面的度规为闵式度规$\eta_{ab}$，坐标系为伪笛卡尔坐标系，此时上面的公式需要分开讨论：$\eta_{ab}(\frac{\partial}{\partial x^0})^b=-(dx^0)_a$，$\eta_{ab}(\frac{\partial}{\partial x^i})^b=(dx^i)_a$，其中$i$取1，2，3。
19. 可以使用抽象指标方便地表示张量的对称性，例如$T(u,v)=T(v,u)$表示这个(0,2)型张量是对称的，用抽象指标可改写为$T_{ab}u^av^b=T_{ab}v^au^b=T_{ba}v^bu^a=T_{ba}u^av^b$，因此$T_{ba}=T_{ab}$就表示$T_{ab}$是对称的。第二个等号是通过交换抽象指标完成的。
20. 这里需要注意，$T_{ab}$和$T_{ba}$分开说都表示同一个$(0,2)$型张量，并不表示$T_{ab}$是对称的，但是将他俩放到一个等式中，就表示对称了。
21. 一个$(0,2,)$型张量的对称部分：$T_{(ab)}:=(T_{ab}+T_{ba})/2$，反对称部分：$T_{[ab]}:=(T_{ab}-T_{ba})/2$。
22. 一个$(0,3)$型张量$T_{abc}$的对称部分为：$T_{(abc)}:=\frac{1}{3!}(T_{abc}+T_{bca}+T_{cab}+T_{cba}+T_{bac}+T_{acb})$，6项的平均。反对称部分：$T_{[abc]}:=\frac{1}{3!}(T_{abc}+T_{bca}+T_{cab}-T_{cba}-T_{bac}-T_{acb})$。偶排列-奇排列。可以看到对于高阶张量，不存在类似于二阶张量的分解（$T_{ab}=T_{(ab)}+T_{[ab]}$）。
23. 如果$T_{abc\cdots}=T_{(abc\cdots)}$，则称它为全对称的，此时指标的任意排列都相等。如果$T_{abc\cdots}=T_{[abc\cdots]}$​，则称它为全反对称的。所有的偶排列都相等，所有的奇排列也相等，是偶排列相反张量。
24. 一个张量的对称部分是全对称的，反对称部分也是全反对称的。一个全对称张量的反对称部分为零张量，一个全反对称张量的对称部分为零张量。
25. 上述结论对于$(k,0)$型张量也成立。

## 导数算符

1. 可以给流形附加上一个导数算符$\nabla$，导数算符并不唯一。它作用到流形上的标量场$f$，结果为对偶矢量场$\nabla f$。
2. 因此导数算符定义为一个映射：$\nabla:=\mathscr{F}_M(k,l)\to \mathscr{F}_M(k,l+1)$。因此$\nabla$可以改写为$\nabla_a$。要满足如下5个条件：
   1. 线性性：$\nabla_a(\alpha T+\beta S)=\alpha\nabla_a T+\beta\nabla_aS$。
   2. 莱布尼兹律：$\nabla_a(T\otimes S)=T\otimes\nabla_aS+\nabla_aT\otimes S$。
   3. 
   4. 
26. 

# 矩阵位移法

1. 推导：普通杆件的单元刚度方程，可以通过最小势能原理得出，当应变能-外力功取驻值时，单元平衡。

2. 二维矩阵位移法的一个例子：

   ```python
   输入数据K文件主要包含如下，所有的列表都是numpy.ndarray类型。
   #节点编号Nodes为：[[0,0],[1,0],[0.5,0.866]]，分别为1，2，3号节点
   #单元编号Elements为：[[1,2],[2,3],[3,1]] 分别为1，2，3号单元，单元内的节点编号也很重要。
   #单元类型ElementsType：[1,1,1] 目前只有一种类型就是二力杆(编号为1)
   #荷载Loads：[[0,0],[0,0],[0,100]]，目前只支持节点的单个集中荷载，分别对应1，2，3号各个节点的。
   #边界条件BoundaryConditions：[[0,0],[None,0],[None,None]]，
   ```

10. 代码：

    ```python
    # 应该从输入数据K文件中读取，不过目前使用手动输入，为了使用矩阵的运算，所有列表都是numpy.ndarray类型。
    import numpy as np
    from math import *
    #节点坐标，边界条件，荷载向量都是全局坐标系下的结果
    Nodes = np.array([[0, 0], [1, 0], [0.5, sqrt(3)/2]])  # 节点编号，分别为0，1，2号节点
    Elements = np.array([[0, 1], [1, 2], [2, 0]])  # 单元编号，分别为0，1，2号单元
    ElementTypes = np.array([0, 0, 0])  # 单元类型，目前只有一种类型就是二力杆(编号为0)
    #材料模型，0号表示线弹性各向同性
    Loads = np.array([[0, 0], [0, 0], [0, 100]])  # 荷载，目前只支持节点的集中荷载，分别对应0，1，2号各个节点的
    BoundaryConditions = np.array([[0, 0], [None, 0], [None, None]])  # 边界条件，目前只支持节点的固定位移约束
    ElementStiffness_0_local = np.array([[1, -1], [-1, 1]])  # 0类型单元的局部单元刚度矩阵
    # 获取单元倾角
    def cos_sin(a, b):  # a,b分别为2个点的坐标，例如[0,0]和[3,4]，结果为(0.6,0.8)
        L = hypot(b[0]-a[0], b[1]-a[1])  # 根据直角边，求斜边长
        return (b[0]-a[0])/L, (b[1]-a[1])/L
    # 坐标变换矩阵T
    def T(ElementNumber):
        ElementType = ElementTypes[ElementNumber]
        if (ElementType == 0):
            cosAlpha, sinAlpha = cos_sin(
                Nodes[Elements[ElementNumber][0]], Nodes[Elements[ElementNumber][1]])
            return np.array([[cosAlpha, sinAlpha, 0, 0], [0, 0, cosAlpha, sinAlpha]])
    # 整体坐标系下的单元刚度矩阵
    def K(ElementNumber):
        ElementType = ElementTypes[ElementNumber]
        if (ElementType == 0):
            T0 = T(ElementNumber)
            a = Nodes[Elements[ElementNumber][0]]
            b = Nodes[Elements[ElementNumber][1]]
            return np.dot(np.dot(T0.transpose(), ElementStiffness_0_local), T0)*(200*10**9 * 0.001/hypot(b[0]-a[0], b[1]-a[1]))
    #由单元刚度矩阵组装成整体刚度矩阵时，需要进行逆切片，也就是说把单元刚度矩阵当作整体刚度矩阵的切片，还原回去。
    #假设单元刚度矩阵对应的自由度编号为a，例如[0,1,2,3]
    #
    #逆切片
    def TranslateElementStiffness(ElementNumber):
        ElementType = ElementTypes[ElementNumber]
        if (ElementType == 0):
            FullMatrix = np.zeros((len(Nodes)*2,len(Nodes)*2), np.float32)
            tmp = []
            for i in Elements[ElementNumber]:
                tmp += [2*i, 2*i+1]
            FullMatrix[np.ix_(tmp, tmp)] = K(ElementNumber)
        return FullMatrix
    #构造整体刚度矩阵
    def constructGlobalStiffness():
        GlobalStiffness = np.zeros((len(Nodes)*2,len(Nodes)*2), np.float32)
        for ElementNumber in range(len(Elements)):
            GlobalStiffness += TranslateElementStiffness(ElementNumber)
        return GlobalStiffness
    #处理边界条件
    def TreateBCs(GlobalStiffness, Loads):
        tmp = CalculatePrescribed()
        TreatedGlobalStiffness = np.zeros((len(tmp),len(tmp)), np.float32)
        TreatedGlobalStiffness = GlobalStiffness[np.ix_(tmp, tmp)]
        TreatedLoads = np.zeros(len(tmp), np.float32)
        TreatedLoads = Loads.reshape(-1,1)[np.ix_(tmp)]
        return TreatedGlobalStiffness, TreatedLoads
    #已知边界条件对应的自由度编号
    def CalculatePrescribed():
        Prescribed = []
        for i in range(2*len(BoundaryConditions)):
            if(BoundaryConditions.reshape(-1)[i] == None):
                Prescribed += [i]
        return Prescribed
    
    GlobalStiffness = constructGlobalStiffness()
    TreatedGlobalStiffness, TreatedLoads= TreateBCs(GlobalStiffness, Loads)
    utmp = np.linalg.solve(TreatedGlobalStiffness, TreatedLoads)
    u = np.zeros((len(Nodes)*2,1), np.float32)
    Prescribed = CalculatePrescribed()
    u[np.ix_(Prescribed)] = utmp
    ```

# 微分方程近似解

1. 分为2大类：离散坐标方法和分布坐标方法。
2. 离散坐标方法，就是只会求解定义域中离散点上的近似解，其他点的解可以通过插值获得。将微分方程转化为了差分方程，未知量为离散点上的近似解。通常用在求解CFD和初值问题中。
   1. 有限差分法：使用各种差分格式来替换各阶导数。
   2. 逐步积分法，通常用在初值问题中，也可以用来处理边值问题，此时会从边界的一侧向另一侧传播
      1. 欧拉方法：
      2. 龙格库塔法：
3. 分布坐标方法，是会求解整个定义域上近似解。用一系列满足全部或部分边界条件的基函数的线性组合作为解的近似，组合系数为待求量。
   1. 加权残值法，直接对微分方程进行处理，由于近似的引入，原始方程不在平衡，产生了残差。
      1. 内部残值（Internal）：
         1. 配点法（Point Collocation Method）：强制使得残差函数$R(x)$在多个配点上的值为0。类似于用扣子把衬衣的两侧固定住，扣子的位置就是配点。配点的个数就是待求变量的个数，即$n$，随着配点的密度增大，配点之间的残差幅值可能会变小，不过也可能变大。由于基函数天然满足边界条件，因此所有的配点都应在内部选取。这个相当于选取以配点为中心的冲激函数作为权重函数。由冲激函数的积分特性$\int_{Domain}\delta(x_j)R(x)=R(x_j)$可知。由于边界条件不一定对称，因此得出的线性方程组的系数矩阵也不一定对称。它是加权残值法中最简单的一个，但是精确度不太好。
         2. 子域法：将定义域分成n个小块，强制使得残差函数在多个小块上的积分为0。这里相当于将权重函数$w_j(x)$设置为仅在某个小块上取值为1，其余地方取值均为0。比配点法复杂的是，这里必须要实际计算定积分。随着分块数量的增加，每个块越来越小，这会使得块内的残差幅值也变小。通常来说子域法会比配点法精度更高。这个相当于选取两个单位阶跃函数的差作为权重函数。
         3. 伽辽金法：不再专门选取权重函数，而是使用试函数当作权重函数，即令$\int_{Domain}R(x)\psi_j(x)=0$​，正好得出n个方程，注意这里的积分还是在整个定义域上进行的。这里的积分可能很复杂，建议使用符号计算工具或数值积分完成。也可以使用分部积分，提高权重函数的微分次数，降低试函数的微分次数，优点有：
         
            1. 由于分部积分的一项会出现试函数或其倒数在边界上的函数值，可能会由于试函数满足的边界条件，而导致简化。下面例子中的本质和自然边界条件会使得等号右侧第一项为0。在大多数的结构力学问题中，都包含对位移高阶导数。
            2. 还可以降低对试函数光滑性的要求，使用等号右侧，只需要试函数满足一阶导数可积，原来需要二阶。
            3. 这常常导致结果线性方程组的系数矩阵是对称的，从下面的两个一阶导数乘积可以看出，交换i和j没有区别。对称的系数矩阵求解要更方便些。
            4. 试函数只需要满足本质边界条件即可，其他边界条件已经隐藏到了分部积分等式右侧的第一项中。
            5. 例如：
         
            $$
            \int_{Domain}\psi_j(x)\frac{d^2\psi_i(x)}{dx^2}=\psi_j(x)\frac{d\psi_i(x)}{dx}|_{\partial Domain}-\int_{Domain}\frac{d\psi_j(x)}{dx}\frac{d\psi_i(x)}{dx}dx
            $$
         
         4. 有限单元法，可以看作是在子域上的伽辽金法。这里的子域被称为单元。
         
            1. 主要求解的是单元内的位移，可以使用结点位移当作组合系数（广义坐标），用各点的形函数当作基函数来构造单元内的位移$u(x)=\sum_{i=1}^nu_iN_i(x)$，其中n为节点个数。高阶的形函数可以使用拉格朗日插值方法来构造。
            2. 优点是该方法的广义坐标一般都有直接的物理含义。
            3. 结构网格产生的方程组的系数矩阵会有一些特点，有利于快速求解。
            4. 和一般加权残值法不同的是，基函数的个数并不是任意的，而是和单元的节点数相同。并非每个形函数都满足单元的边界条件，而是跟广义坐标组合到一起后才满足。
            5. 由于要使用伽辽金法，因此只用满足本质边界条件即可。对于单元来说，本质边界条件就是位移模式在各个节点上的值$u(x_i)$要等于节点的位移$u_i$。
            6. 实际上对于有限元软件来说，位移边界条件放在边界条件模块中，而力边界条件被当作荷载来施加。
            7. 对于单元来说，选取位移模式时，并不用考虑整体的边界条件。只需要在最后构成整体刚度方程后，边界单元考虑相关的边界条件。
            8. 将控制微分方程作用在单元的位移模式上，会产生残差，使用伽辽金法来处理这个残差，权函数就是各个形函数。得到的方程组就是单元刚度方程组。
            9. 控制微分方程中的分布力指的是实体单元的体积力，并非作用在边或面上的分布力，后者是边界条件，前者不是。
            10. 对包含应力的体积分项应用分部积分后，或出现体积边界，也就是面边界上的一些积分。这些项需要用面上的分布力来确定。
                $$
                {\displaystyle \int _{\Omega }u\,\nabla \cdot \mathbf {V} \,d\Omega \ =\ \int _{\Gamma }u\mathbf {V} \cdot {\hat {\mathbf {n} }}\,d\Gamma -\int _{\Omega }\nabla u\cdot \mathbf {V} \,d\Omega ,}
                $$
            11. 以下只考虑实体单元，结构单元比较特殊。最简单的实体单元是六面体，有8个顶点（node），12条边（edge），6个面（face）。单元可能有一个顶点，边或面在边界上。因此可能会受到荷载。可能分为节点的集中荷载，边或面上分布荷载。边和面上的分布荷载都要等效到节点上。
            12. 整体的力和位移边界条件可以分为集中和分布的。当投射到单元上时，也成了节点集中，边界集中和边界分布。边界集中可以看作分布的特例，也就是用
            13. 在软件中也不是想往哪施加荷载都可以的。
            14. 不过由于结点是多个单元共享的，如果网格不发生撕裂，即节点不分离，则可以认为该节点上的集中力只属于某个单独的单元，或者在单元间平均分布，反正最后到整体刚度方程时还会汇总到一起。
            15. 实际工作中，不会再构造单元的刚度方程，而是仅构造单元的刚度矩阵，然后组装成整体的刚度矩阵，最后把整体的边界条件施加到整体结构上。
            16. 力边界条件分为两种，作用在节点的集中力，和作用在边界上的集中或分布力。在对伽辽金法使用分部积分法时，会产生边界上的取值，这会引入作用在节点的集中力。
            
            17. 位移边界条件会被留到最后组装完整体刚度矩阵后再处理。
            
            18. 由于伽辽金法不再切分子域，因此是对整个单元积分。
            19. 一维二力杆单元，边界条件为：在端点施加的沿杆方向的集中荷载$p_1,p_2$，端点的沿杆方向的位移为$u_1,u_2$。这里先认为$u_1,u_2$，$p_1,p_2$都是已知的。控制方程为$\frac{d}{dx}(EA\frac{du}{dx})+f(x)=0$。$f(x)$为沿杆方向的分布力，可能是重力，摩擦力等，是已知的。
            20. 如果使用纯粹地伽辽金法，并使用分部积分。构造近似函数可以是$u(x)=a_1(u_1N_1(x)+u_2N_2(x))$。其中$N_1(x)=1-x/L$，$N_2(x)=x/L$。$a_1$是待定系数。实际上基函数可以使用更高阶的函数，或三角函数，同时也可以使用多个基函数的组合，但是这样就够了。将近似函数带入，然后得到$R(x)$。令$\int_{Domain}R(x)\cdot (u_1N_1(x)+u_2N_2(x))dx=0$。
            21. 不过这里转换了以下思路，认为$u(x)=u_1N_1(x)+u_2N_2(x)$，即$N_1(x),N_2(x)$是试函数，$u_1,u_2$是待定系数，可以看到这里的基函数$N_i(x)$就不满足本质边界条件了，但是整个函数$u(x)$仍然满足。这样带入控制方程，残差处理后，得到的线性方程组就是单元的刚度方程组。但是不能像之前一样，通过求解该方程直接求出待定系数。因为此时该方程是奇异的。
            22. 线性方程组中会出现$f(x)N_i(x)$的项，这就是将分布荷载向节点等效。再对被积函数使用分部积分即可得到和自然边界条件有关的项，替换进去即可。这样位移模式就满足所有的边界条件了。
            23. 对于单元来说，$u_1,u_2$是已知量，对于整个结构来说，$u_1,u_2$是未知量。
            24. 
            25. 
            26. 
            27. 
      2. 边界残值
         1. 边界元法：数学上较为复杂，但是结果的精度较好。
   2. 泛函驻值法，使得一个描述系统特定属性的泛函取最大或最小值，例如系统的总能量。使用泛函来表达不同变量的关系是比较容易的，尤其是关系非常复杂时，例如流固耦合，包含控制机构的结构动力学问题。
      1. 瑞利-利兹法：
      2. 有限单元法：
4. 可以看到从泛函驻值法和加权残值法都可以推导出有限元方法。

## 加权残差法 WRM

1. 待求得线性微分方程用如下形式表示：$L(f(x))-g(x)=0$，其中$L(\cdot)$是一个线性微分算子。$g(x)$已知，$f(x)$为待求。$L(\cdot)=a_0(x)+a_1(x)\frac{d}{dx}+a_2(x)\frac{d^2}{dx^2}+\cdots$。

2. 将$f(x)$使用近似：$f(x)\approx\sum_{i=1}^na_i\psi_i(x)$。这一步实际是将一个可以完全自由取值的任意函数$f$用有限个基函数（或试函数）来组合，是一个投影过程。系数$a_i$被称作广义坐标。每个试函数都需要满足所有的边界条件，这样他们的组合也满足边界条件，对于复杂形状和复杂边界条件选取合理的试函数往往比较困难。也要求试函数和待求函数具备相同的连续性和可导性。

3. 将近似带入上面的微分方程，由于$L$是线性的，上式为：$\sum_{i=1}^na_iL(\psi_i(x))-g(x)=R(x)$。这个$R(x)$就是残差。残差并不是误差（error）。误差是真实解$f(x)$和近似解在整个定义域上的差值。残差是由于误差的引入产生的控制方程不平衡项。

4. 所有的加权残值法变种都是为了使得残差最小化，一般是积分意义上的最小化。因为残差不可能为0，除非$f(x)$恰好能够由有限个$\psi_i(x)$的组合表示。如果残差为零函数，此时认为得到了精确解。

5. 使得残差最小化，会得出一个关于组合系数的线性方程组。

6. 令残差函数在整个域上的积分为0，此时残差函数在部分域取正值，部分域取负值。

7. 如果只是对残差函数$R(x)$积分，则只能得到一个方程。但是这里有n个未知的系数$a_1,\cdots,a_n$。这里的残差的加权函数是1，也可以采用不同的权函数。如果使用n个不同的权函数，就可以得到了n个不同的方程，来确定这n个系数了。权函数一般不用特别复杂的函数，但是一定要线性无关，否则得到的线性方程组的解不唯一。因此最终公式为：

8. $$
   \int_{Domain}w_j(x)R(x)dx=\int_{Domain}w_j(x)(\sum_{i=1}^na_iL(\psi_i(x))-g(x))=0
   $$

9. 权值函数的可能性：

   1. 伽辽金法：权值函数就是试函数本身。对于存在非线性系数的情况，取$w_j=\frac{\partial u}{\partial a_i}$，即近似函数对系数的偏导数。

   2. 伪谱方法，也就是配点法：权值函数是以离散点为中心狄拉克$\delta$函数。

   3. 最小二乘法：权值函数为残差函数对系数的偏导数。这相当于让残差函数的$L^2$范数为0。

   4. 矩方法：权值函数为幂函数序列，当所需精度较高时很少使用，因为需要对Hilbert矩阵求逆。

10. 
