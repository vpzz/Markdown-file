# 基础

1. LSTC公司在2019年被ANSYS公司收购，LS-DYNA源自LLNL的John O.Hallquist博士于1976年开发的3D有限元分析程序DYNA3D。DYNA3D是为了模拟全引信选项或可调当量核弹在低空释放（撞击速度约为40m/s）时的撞击而创建的。1978年，应法国的要求，DYNA3D源代码被无限制地发布到公共领域。

2. 1988年底，LSTC公司成立，以更专注的方式继续开发DYNA3D，从而产生了LS-DYNA3D（后来缩写为LS-DYNA）。因此，DYNA3D的发布和支持被停止。

3. LSTC还开发了自己的预处理器LS-PrePost，它是免费分发的，无需许可证即可运行，也可用于查看和后处理模拟结果。

4. Prepost的开发工作主要是由大连富坤科技公司负责，界面内核使用WxWidget GUI库和OpenGL图形库，3D引擎使用OpenCascade。

5. 在2.4~4.6版本期间，新旧界面同时存在，可以按F11切换。4.7及以后版本，只保留新界面。配置文件名称为.lsppconf。

6. 按下F1键可以设置快捷键，按下Shift+Fn键，可以直接运行对应的Fn.cfile文件，优先在配置文件中functionkey_path键指定的目录下查找，其次在当前工作目录，最后在配置文件目录。

7. 多边形选取时，单击左键添加角点，单击右键结束选择。

8. File→Update可以更新读取结果文件，适用于一边计算，一边后处理。

9. 使用prepost读取k文件时，可以打开Misc.→view message info查看是否产生了错误信息。

10. Misc.→Keyword File Separate可以将k文件分割成多个。

11. LS-DYNA主要的应用方面：汽车碰撞和乘员安全，金属钣金成型，飞机鸟击，爆炸侵彻，晃液分析，跌落测试。

12. LS-DYNA垄断了国内外汽车厂商的碰撞安全分析应用，全球80%的汽车制造商将它作为首选的碰撞分析工具。Occupant（乘员）是汽车行业中车内人员的专用称呼。

13. 行业专用的分析软件可以是在通用软件上开发得到，例如DYNAFORM是在LS-DYNA上开发的。

14. Prepost可以处理全部格式的LS-DYNA计算结果文件。

15. Model checking可以检查接触，单元质量，引用的实体是否存在。

16. 在keyword card编辑页面中，可以勾选`use *parameter`，这与`*PARAM`关键字有关，在LS-DYNA中可以先定义参数，然后在K文件中引用该参数名，这通常用于LS-DYNA和LS-OPT联合迭代优化。

17. 在节点上单击鼠标中键可以将其设置为旋转中心，再次单击中键，可以取消设置。

18. DYNA计算结果文件D3hsp是ASCII格式，包含大量信息，由于该文件通常特别大，用户直接打开搜索不太方便，因此prepost可以读取该文件，通过Misc.→D3hsp可以用树和列表形式显示内容，方便使用。

19. Prepost支持IGES和STEP两种通用的几何格式。读取时会自动对几何或拓扑错误进行清理，缝合邻接曲面。

20. Shape Mesher和Block Mesher都可以直接创建网格，而不需要借助几何，可以生成四边形或六面体网格。

21. Auto Mesher借助曲面几何来生成三角形或四边形网格，也可以对已有曲面网格重新划分网格。

22. Tetrahedron Mesher可以借助封闭的壳单元网格生成四面体网格，这里的封闭壳网格可以用先用Auto Mesher划分得到。

23. Solid Meshing可以基于映射或扫掠创建结构化的六面体或五面体网格。

24. Element Generation可以根据实体网格抽取壳单元中面。

25. 在固体力学中，差分法是有限元法出现前的主要方法。爆炸软件AUTODYN和岩土工程软件FLAC就是使用差分法。差分法对于复杂边界适用较差。

26. 有限元法的缺点是难以处理有极大单元变形的情况，预估产生的误差比较困难。

27. 有限体积法基于积分形式的守恒方程，而非微分方程。

28. 边界元法只在求解域的边界上划分单元，用满足控制方程的函数去逼近边界条件。基本思想是利用格林定理，将全域的控制方程转化为边界上的积分方程。与有限元方法相比，降低了问题的维数和自由度数量。通过引用问题的基本解，而具有解析和离散相结合的特点，使得计算精度较高。缺点是需要存在相应微分算子的基本解，对于非均匀介质等问题难以应用，适用范围远不如有限元法。DYNA的声学计算支持边界元功能。

29. 离散元法起源于分子动力学，是为了研究岩体等非连续介质而发展起来的。离散单元本身为刚体，单元间的相对位移等行为由联接节点间的变形元件来实现，允许单元间的相对运动，不必满足位移连续和变形协调条件。适用于模拟节理系统或离散颗粒混合，分离，输运等过程。

30. SPH法是一种为解决天体物理中涉及的流体质团在三维空间无边界情况下的任意流动拉格朗日问题而开发的，后来发现对于模拟连续体结构的解体，断裂等问题或大变形流动非常有效。SPH适合用来求解具有大变形，复杂边界和物质交界面等复杂单相，多相流体动力学问题，是最早的无网格法。SPH适用一系列的粒子来表示求解域，粒子具有质量，速度，温度等物理量，粒子之间不需要任何连接，具有无网格特性。理论基础是插值理论，通过一种称之为核函数的积分核进行插值近似，将流体力学方程组转化为SPH方程组。SPH的近似过程不受网格限制，可以避免网格极度大变形时的精度下降问题。缺点是：拉伸不稳定会引起数值断裂，需要复杂的接触算法。DYNA包含SPH方法。

31. LS-DYNA的授权方式：依据软件同时可以运行在的核心数量。例如一个8核的许可证允许以下任何一种情况（以及更多）：

    1. 用户在8个核心上并行运行一个job，

    2. 用户并行运行两个job，每个使用4个核心，

    3. 用户运行8个job，每个使用1个核心。

32. DYNA的求解器就是一个静态编译的可执行文件：`ls-dyna_smp_d_R11_1_0_winx64_ifort160`。smp表示对称多处理，就是共享内存，使用OpenMP编程的。d表示双精度，R11_1_0表示求解器为11.1.0版本，ifort160表示Intel Fortran Compiler 版本。

33. dyna求解器只接受k文件，其中全部由关键字组成，以*开头。

34. dyna在求解不同k文件时，求解产生的文件都是同名的，这点和abaqus不一样，因此一个文件夹中，建议只保存一个k文件及其结果。

35. dyna默认进行显式求解，除非指定隐式关键字。

36. 按F11键，可以切换prepost的新旧界面。

37. Part，Material，Section，EOS都有对应的ID，分别为PID，MID，SID，EOSID。同一个part内的单元具有相同的材料和截面，还有相同的沙漏控制方法。可以在Model→PartData中查看，赋予part相关的信息，这个比直接在Keyword中修改方便些。

38. 和abaqus不同，part关键字在ls dyna中是必不可少的，它将材料，截面，控制等关键字联合起来。abaqus是通过截面将材料和单元集合关联起来的。因此ls dyna的刚体材料关键字中是可以设置是否约束使用此材料的part的质心的运动的，当然也支持使用constrained来约束。

39. 实体和壳截面使用不同的关键字，section_soli和section_shell，不过他们的SID不能重复。单元公式ELFORM也在section中设置。显式计算默认的单元公式就是缩减积分，在隐式计算中才推荐使用全积分。

40. tshell就是厚壳，类似于abaqus的连续体壳，单元形状和实体一样，但是公式是壳公式。

41. 梁单元支持spot weld beam 的公式，它要配合*MAT_SPOTWELD一起使用。

42. 0D单元包括线性弹簧和扭转弹簧。

43. `*ELEMENT_XX`要使用对应的`*SECTION_XX`。

44. 使用缩减积分的单元，尤其是四边形或六面体，需要加入沙漏控制，`*CONTROL_HOURGLASS`，其中IHQ推荐为6，QH为默认的0.1。沙漏控制是添加到使用缩减积分的四边形壳单元和六面体实体单元的粘性或刚度。

45. 除了使用`*CONTROL_HOURGLASS`进行全域控制外，还可以使用`*HOURGLASS`来创建不同的沙漏控制设置，然后在`*PART`中关联特定的沙漏控制ID。

46. 计算结束后，应该检查hourglass energy应该<internal energy的10%。使用`*DATABASE_GLSTAT`输出全局统计和能量，`*DATABASE_MATSUM`输出part的能量。

47. 之所以称为沙漏，可以参见下图，两个相邻的四边形，在没有沙漏控制的情况下，变形会得到两个梯形，组合在一起看起来像沙漏。

48. ![image-20250111212335778](LS-DYNA.assets/image-20250111212335778.png)

49. 分析的类型通过control系列关键字设置。结果输出在database关键字中设置。

50. 常用的关键字如下：

    ```
    *NODE *ELEMENT
    *PART *MAT *SECTION
    *INITIAL *BOUNDARY *LOAD *CONSTRAINED
    *CONTROL
    *DATABASE *INTERFACE
    ```

51. 关键字在prepost和手册中是以card卡片的形式给出的。一个关键字可以有多个卡片，有时卡片数量还取决于特定变量的值。每个卡片最多包含8个变量，每个变量都有名称variable，类型type和或默认值default。

52. ![image-20250102183115183](LS-DYNA.assets/image-20250102183115183.png)

53. K文件中不需要写variable，只需要按顺序给出数据即可。不过prepost导出的k文件，都在数据行的上方会以注释的形式给出variable，方便用户后续手动修改。

    ```shell
    *CONTROL_SOLUTION
    $#    soln       nlq     isnan     lcint
         &soln         0         0       100
    ```

54. 材料模型的关键字可以是具体名称，也可以是编号，例如`*MAT_001`等于`*MAT_ELASTIC`。

55. 常用的材料模型：

    ```shell
    *MAT_ELASTIC #1号，各向同性，线性亚弹性，需要给出密度，弹性模量，泊松比。可用于梁，壳，实体单元。不适用有限应变，如果要模拟有限应变，应该使用MAT_002
    *MAT_PLASTIC_KINEMATIC #3号，各向同性，双线性强化，可以考虑率效应。性价比非常高，可用于梁，壳，实体单元。通过修改β参数来设置强化形式，β=0表示运动强化，β=1表示各向同性强化，如果β在二者之间，则为混合强化。
    ```

56. *MAT_PLASTIC_KINEMATIC材料模型可以使用Cowper Symonds应变率模型来考虑应变率效应，它根据$1+(\frac{\dot{\varepsilon}}{C})^{1/p}$来对屈服应力进行缩放。card2中的SRC和SRP分别为参数C和p，默认均为0，表示不考虑应变率效应的缩放。默认情况下VP=0，表示应变率效应会对屈服应力进行缩放，也可以设置VP=1，此时为完全粘塑性公式，它在屈服面内结合了Cowper Symonds公式。

57. 对于`*MAT_PLASTIC_KINEMATIC`，如果β=1，此时推荐使用`*MAT_ISOTROPIC_ELASTIC_PLASTIC`，12号材料，它需要更少的存储，因为不用存储背应力，且更高效。不过对于壳单元，它的精度不够，还是推荐使用2号材料。

58. 分段线性MAT_024模型中，支持三种输入方式：曲线LCSS；数据点EPS，ES；屈服点和硬化模量。按照曲线>数据点>屈服参数的优先级采用。数据点的横坐标是EPS（有效塑性应变），纵坐标是ES（有效应力），对于单轴拉伸，有效应力就是单轴应力，有效塑性应变为单轴塑性应变，因为一般假设塑性变形是等体积的，即泊松比为0.5。

59. 可以从k文件中导入其中定义的材料，在keyword→loadMatDb，选择对应的k文件即可。不过需要选中mat关键字才会出现loadMatDb。

60. ls dyna的element只是负责构建单元拓扑，也就是形状。同样的solid可以使用各种不同的单元公式，而在abaqus中，这是在单元层面就区分开的，而非在section层面。这也是ls dyna单元数量较少的原因。

61. 可压碎泡沫（crushable foam）是指类似于聚氨酯泡沫的材料，受压缩时，它会碎裂，而非海绵一样的泡沫。在dyna中，可压碎泡沫经常和混凝土，土壤共用相同的简单材料模型。

62. 在Load Cruve中，ordinate表示纵坐标，abscissa表示横坐标。

63. 一些关键字（例如*MAT_005）允许使用关键字自带的表格输入（一般是10个点，每个点一个横坐标，一个纵坐标），也允许通过引用用户定义的曲线来输入，后者的优先级高。

64. unloading表示卸载，而非未加载。

65. 应变硬化（Strain Hardening）是指材料在塑性变形过程中，随着应变的增加，其屈服强度逐渐提高的现象。

66. Tensile cutoff是拉伸截止，也就是破坏时的最大主应力。

67. 很多材料模型都需要配合状态方程使用，因为材料模型仅处理偏应力和塑性变形相关的行为，而压力和体积应变的关系需要状态方程来处理。

68. 最常用的K&C Concrete模型，是由Karagozian&Case开发的，它是一家国际公认的科学和工程咨询公司，1945年成立，不过也是该公司两个创始人的姓名。

69. 16、72、96和84号材料支持整体式建模来模拟钢筋混凝土，它将钢筋混凝土当成一种复合材料。也可以进行分离式建模，此时使用梁单元以离散方式对钢筋进行建模。这些梁可以合并到实体混凝土单元（共节点），或者可以使用1-D接触（这可以处理粘结滑移）连接到混凝土单元，或者可以通过`*CONSTRAINED_AGRANGE_IN_solid (CTYPE=2)`连接到混凝土单元。最后一种方法消除了必须将梁节点与实体单元节点对齐的负担，但是要注意钢筋对混凝土的约束可能会与对称边界条件等其他约束冲突并破坏这些约束。

70. 使用`*CONTACT_AUTOMATIC_SINGLE_SURFACE`设定接触时，可以点击名称右侧的小按钮来选择已有的segment set ，shell element set ，part set，part，node set 等，如果没有，则会提示创建，选择NewEntity即可。由于是single surface，只需要选择一个面即可，它既是master，又是slave。

71. segment就是单元的face。

72. 摩擦行为通过设置FS（静摩擦系数），FD（动摩擦系数），DC（衰减指数）。显式分析中使用的等效摩擦系数为：$\mu_c=FD+(FS-FD)e^{-DC|v_{rel}|}$​，和相对速度有关。

73. 在可选card A中，可以指定使用罚函数公式（默认），还是约束公式。

74. ls dyna中会将tie作为接触的一种，因为它的一个特化，tiebreak允许tie失效，而变成可以分离和滑动的普通接触。

75. 罚接触公式中，罚刚度会根据单元尺寸和材料性质来计算：

    1. 对于壳来说，$k_1=slsfac*sf*K*A/d$。其中slsfac是全局缩放因子，sf是局部缩放因子，K是体积模量，A是单元面积，d是厚度或最短对角线。

    2. 对于实体来说，$k_1=slsfac*sf*K*A^2/V$。其中A是segment面积，V是单元体积。

76. 对于罚接触来说，如果接触的两个面的材料相似，计算效率就比较高，如果一个很硬，一个很软，则容易失效，此时可以缩小card3中的slave面的局部缩放因子（例如为0.1），降低slave侧的冲击，减少过大的穿透。

77. bsort参数可以指定搜索接触配对的频率，每隔bsort个增量才会搜索一次，对于single contact，为25或100。surface to surface或node to surface，为10~15。如果为0，则由dyna自己决定，可以在d3hsp中找到。如果发现干涉较多，可以降低这个参数的值，来提高搜索频率。

78. d3hsp中有很多关于求解初始化的数据。

79. slsfac是在`*control_contact`中设置，默认为0.1。

80. prepost中可以检查tie的效果或初始穿透，菜单栏→application→Model checking→general checking。

81. tied接触，默认会将slave点拉到master面上，接触面上的单元会变形。

82. element tool→dupnod可以检查并合并共节点。

83. mortar contact是dyna中专门为隐式分析使用的接触公式，它是segment to segment，基于罚函数的。

84. 一般常用contact_automatic_surface_to_surface指定接触对，可以输出接触力。

85. 零件较多时，可以创建一个包含所有可能接触的零件的set，然后使用contact_automatic_single_surface接触。缺点是无法输出接触力。可以使用contact_force_transducer_penalty来指定特定接触的接触力输出。

86. 对于复杂模型，可以先用contact_automatic_single_surface，试跑一段时间，检查其他keyword，如果没有问题，可以修改为特定的接触类型。

87. 一般需要打开card1的最后2个参数，sapr和sbpr。

88. ls-prepost中显示云图为fringe，这个单词为条纹的意思。通过颜色条纹或边缘过渡来展示物理量的分布。

89. 可以在create entity中创建CNRB（constrained nodal rigid body），它是由节点构成的刚体域。

90. constrained_joint可以构建球铰，销钉等连接单元。

91. *CONSTRAINED_RIGID_BODIES可以将两个刚体连接起来，刚体需要是由\*MAT_RIGID构成的，但是不是CNRB。

92. `*BOUNDARY_SPC`限制自由度，`*BOUNDARY_PRESCRIBED_MOTION`边界运动，`*INITIAL_VELOCITY_GENERATION`指定初始条件，`*LOAD_NODE`和`*LOAD_BODY_`指定集中力和体积荷载。体积载荷是以加速度的形式给出，默认全局赋予，除非使用`*LOAD_BODY_PARTS`指定要施加的part set。`*LOAD_BODY_Z`的加速度以-Z方向为正，因为会替换成惯性力。

93. 这些边界条件可以对单个节点或节点构成的集合设置，推荐使用CreateEntity来使用。

94. prepost支持将选择的东西临时save起来，后续可以load进来。

95. *LOAD_NODE如果对节点集合施加荷载，则为合力，会在每个节点上均分。

96. dyna将增量称为时间步长time step，这个和abaqus不一样，一般在1e-6秒数量级。可以使用使用`*CONTROL_TIMESTEP`指定初始时间步长DTINIT，目标时间步长DT2MS（会使用质量缩放来确保）。如果是冲击问题，默认的初始时间步长，对于较低的速度来说，还需要多个时间步长才会真正发生碰撞，因此可以手动计算间隙，然后除以速度，来得到初始时间步长，实际设置的比这个略小即可，这样可以快速略过无意义的时间。

97. 一般质量缩放后，超重应该低于10%，可以使用endmas参数控制。在求解输出的message中也可以查看到这个，calculation with mass scaling for minimum dt的ration。

98. 普通求解时，会将`*CONTROL_TIMESTEP`的TSSFAC设置为0.9，如果是告诉碰撞，建议设置为0.67。

99. dyna自动计算的dt和负体积无关，后者主要和网格品质有关。

100. `*CONTROL_TERMINATION`用来指定求解终止的时间。其中的DTMIN可以指定time step相比于初始时间步长（dyna自动计算的，并非用户设置的）的缩小下限，如果小于这个值，则会终止。

101. 可以输出的内容有：ASCII DATABASE，BINARY DATABASE，INTERFACE。

     1. ASCII的输出频率可以设置较高，可以输出特定资料。要输出的项就在关键字中的项前勾选即可，每项可以单独指定dt，都会在工作目录中生成对应的文件。在手册中已经分类整理好了。在post→ASCII中查看，有星号标记则表示存在该数据，可以查看，点击对应项，然后load即可。

     2. `*DATABASE_BINARY_PLOT`可以设置输出d3plot（也就是1帧）的时间间隔。即使不设置，也会至少将求解时长切分20份。在post→fringe中查看动画。

     3. INTERFACE包含零件的应力应变及其边界条件，以关键字的形式输出，可以作为后续分析导入。

102. 如果要输出特定节点（集合）或单元（集合）的时间历程数据，可以使用`*DATABASE_BINARY_D3THDT`。

103. 勾选`DATABASE_ELOUT`，可以开启输出单元数据功能，具体输出哪些单元，需要在`*DATABASE_HISTORY_`中设置。可以在createEntity中创建，根据单元类型选择。

104. 可以在select part中设置，只显示部分part等，然后在file→save as→save active keyword as来只保存显示部分的关键字，不过这样会导致引用未显示部分的关键字出错。

105. 一般来说动态分析使用单精度就够了，隐式或准静态使用双精度（因为存在很多矩阵操作）。

106. 显式求解对于内存的需求比隐式小得多，一般几百M就够了。

107. 求解过程中的信息保存在message文件中。有些重复性的消息并不会全部输出到命令行窗口，但是都会记录在message文件中。

108. 求解过程中，在命令行界面，按Ctrl+C可以中断求解器，提示enter sense switch。可选的有：

     ```shell
     sw1 #输出重启动文件d3dump，然后终止此次求解
     sw2 #输出预估的剩余计算时间，实际时间一般会比这个值要低
     
     ```

109. 重复运行时，建议每次运行前，将之前的d3plot文件都删除掉，否则可能会将2次的结果串接起来，造成混淆。

110. 尽量不要定义重复的接触。

111. 使用prepost进行后处理时，只需要选择d3plot即可，后续的文件会自动打开。

112. 一个d3plot文件会包含多个帧，dyna根据文件大小自动决定何时构建一个新的文件。

113. 负体积问题可能的原因：

     1. 网格品质差，例如长宽比过大，一旦受力，短边节点容易跑到另一侧。

     2. 所选材料模型不合适，造成冲击瞬间，结构发生很大变形。

     3. 如果给与模型过大的冲击速度或力量，也会造成很大变形。可以检查并修改contact中的摩擦系数或scale factor。

     4. 较薄零件若无缓冲效果，例如胶结，可以不使用此零件，直接使用tiebreak contact将两边零件tie住。

114. binout和d3plot是LS-DYNA中两种不同的文件格式，虽然它们都用于存储仿真结果，但它们的用途和内容有所不同。区别如下：

     1. d3plot存储几何和结果数据，主要用于后处理可视化，可以产生动画或进行时间序列分析。文件通常较大，文件名通常为d3plot、d3plot01、d3plot02等（用于分卷存储）。

     2. binout是用于存储纯结果数据的二进制文件，主要用于高效存储和提取特定结果数据。 不包含几何信息，只存储结果数据。文件结构更紧凑，适合快速读取特定数据。可以通过LS-PrePost→post→binout或编程工具（如Python）提取数据。

115. 可以在系统命令行启动lsprepost时，使之读取cfile：

     ```shell
     LS-PrePost c=commandfile #可以加入-nographics，不启动GUI，但仍以批处理模式执行命令
     ```

116. 隐式分析需要设置如下关键字card：

     1. `*CONTROL_IMPLICIT_GENERAL`，将IMFLAGS设置为1，才会开启隐式分析功能，DT0为隐式分析的初始时间步长，可以为总时间的1/10到1/100。

     2. `*CONTROL_IMPLICIT_AUTO`，将IAUTO设置为1，使用自动时间步长。每一个time step使用迭代次数在11±5次内。

     3. `*CONTROL_IMPLICIT_SOLUTION`，NSOLVER设定使用的求解方法。还可以设置收敛容差，DCTOL为位移相对收敛容差，ECTOL为能量，RCTOL为力残差。

     4. `*CONTROL_IMPLICIT_SOLVER`，LSOLVER设定使用的线性方程求解器。

     5. `*CONTROL_IMPLICIT_DYNAMICS`，IMASS设定静态还是动态分析（使用Newmark积分）。

117. 当使用隐式分析时，推荐使用mortar版本的接触方式。

118. 隐式分析中，使用的荷载曲线应该是渐变的，而非显式的突变。

119. 

120. 

121. 

122. 

123. 

124. 

125. 

126. 

127. 

128. 

129. 

130. 

131. 

132. 

133. 

134. 